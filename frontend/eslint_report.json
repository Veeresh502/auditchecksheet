[{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\api\\axios.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\api\\dock.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\api\\mfg.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\admin\\DockAuditPlanView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\AuditDetailsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\AuditEvidenceModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEvidence'. Either include it or remove the dependency array.","line":59,"column":8,"nodeType":"ArrayExpression","endLine":59,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [show, auditId, fetchEvidence]","fix":{"range":[1590,1605],"text":"[show, auditId, fetchEvidence]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\tabs\\CalibrationTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\tabs\\ChecklistTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\tabs\\ObjectivesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\audit\\tabs\\ParametersTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\common\\ConfirmationModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\common\\FilePreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\common\\PromptModal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initialValue'. Either include it or remove the dependency array. If 'setValue' needs the current value of 'initialValue', you can also switch to useReducer instead of useState and read 'initialValue' in the reducer.","line":30,"column":8,"nodeType":"ArrayExpression","endLine":30,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [initialValue, show]","fix":{"range":[697,703],"text":"[initialValue, show]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\common\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\layout\\DashboardLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\layout\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\components\\layout\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\context\\AuthContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\context\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\hooks\\useAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[484,487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[484,487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[742,745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[742,745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2134,2137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2134,2137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3502,3505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3502,3505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7304,7307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7304,7307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Container, Table, Badge, Form, Card } from 'react-bootstrap';\nimport { FaSearch } from 'react-icons/fa';\nimport api from '../../api/axios';\nimport AuditDetailsModal from '../../components/audit/AuditDetailsModal';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport { toast } from 'react-toastify';\nimport * as XLSX from 'xlsx';\n\nconst AdminDashboard = () => {\n  const [audits, setAudits] = useState<any[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  // DETAILS MODAL STATE\n  const [showDetailsModal, setShowDetailsModal] = useState(false);\n  const [selectedAudit, setSelectedAudit] = useState<any | null>(null);\n\n  // DELETE STATE\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    setLoading(true);\n    try {\n      const res = await api.get('/audits/admin/all');\n      setAudits(res.data);\n    } catch {\n      console.error(\"Failed to load dashboard data\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Custom Sort Logic: NC Open -> Assigned -> Submitted -> Completed\n  const sortOrder: { [key: string]: number } = {\n    'NC_Open': 1,\n    'NC_Pending_Verify': 1, // Treat same priority\n    'Assigned': 2,\n    'Submitted_to_L2': 3,\n    'Rejected': 0, // Highest priority\n    'Completed': 4\n  };\n\n  const sortedAudits = [...audits].sort((a: { status: string }, b: { status: string }) => {\n    const orderA = sortOrder[a.status] || 99;\n    const orderB = sortOrder[b.status] || 99;\n    return orderA - orderB;\n  });\n\n  const filteredAudits = sortedAudits.filter((a: { machine_name?: string; template_name?: string; status?: string }) =>\n    a.machine_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    a.template_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    a.status?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleRowClick = (audit: { audit_id: string;[key: string]: any }) => {\n    setSelectedAudit(audit);\n    setShowDetailsModal(true);\n  };\n\n  const handleExportExcel = async (id: string) => {\n    try {\n      const response = await api.get(`/audits/${id}/full`);\n      const { audit, data, non_conformances } = response.data;\n\n      const auditInfo = [\n        [\"Field\", \"Value\"],\n        [\"Audit ID\", audit.audit_id],\n        [\"Machine\", audit.machine_name],\n        [\"Template\", audit.template_name],\n        [\"Date\", new Date(audit.audit_date).toLocaleDateString()],\n        [\"Shift\", audit.shift],\n        [\"Status\", audit.status],\n        [\"L1 Auditor\", audit.l1_auditor_name],\n        [\"L2 Auditor\", audit.l2_auditor_name],\n        [\"Process Owner\", audit.process_owner_name],\n      ];\n\n      const checklistHeader = [\"Section\", \"Question\", \"L1 Observation\", \"Score\", \"Remarks\"];\n      const checklistRows = data.checklist.map((item: { section_name: string; question_text: string; l1_observation?: string; l2_score: number; l2_remarks?: string }) => [\n        item.section_name,\n        item.question_text,\n        item.l1_observation || 'N/A',\n        item.l2_score === 3 ? 'NA' : item.l2_score === 2 ? 'OK' : item.l2_score === 1 ? 'Obs' : 'NC',\n        item.l2_remarks || ''\n      ]);\n\n      const ncHeader = [\"NC ID\", \"Issue\", \"Risk Level\", \"Target Date\", \"Status\"];\n      const ncRows = (non_conformances || []).map((nc: any) => [\n        nc.nc_id,\n        nc.issue_description,\n        nc.risk_level,\n        new Date(nc.target_date).toLocaleDateString(),\n        nc.status\n      ]);\n\n      const wb = XLSX.utils.book_new();\n      const wsInfo = XLSX.utils.aoa_to_sheet(auditInfo);\n      XLSX.utils.book_append_sheet(wb, wsInfo, \"Audit Summary\");\n      const wsChecklist = XLSX.utils.aoa_to_sheet([checklistHeader, ...checklistRows]);\n      XLSX.utils.book_append_sheet(wb, wsChecklist, \"Checklist Observations\");\n      if (ncRows.length > 0) {\n        const wsNC = XLSX.utils.aoa_to_sheet([ncHeader, ...ncRows]);\n        XLSX.utils.book_append_sheet(wb, wsNC, \"Non Conformances\");\n      }\n      XLSX.writeFile(wb, `Audit_Report_${id}.xlsx`);\n      toast.success(\"Excel Downloaded!\");\n    } catch {\n      console.error(\"Excel Export failed\");\n      toast.error(\"Failed to download Excel report\");\n    }\n  };\n\n  const handleDeleteRequest = () => {\n    // Close detail modal, open confirmation\n    setShowDetailsModal(false);\n    setShowDeleteConfirm(true);\n    // selectedAudit is already set\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (!selectedAudit) return;\n    setDeleting(true);\n    try {\n      await api.delete(`/audits/${selectedAudit.audit_id}`);\n      toast.success(\"Audit deleted successfully\");\n      fetchData();\n      setShowDeleteConfirm(false);\n      setSelectedAudit(null);\n    } catch {\n      toast.error(\"Failed to delete audit\");\n    } finally {\n      setDeleting(false);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    let badgeClass = 'badge-info-subtle';\n    switch (status) {\n      case 'Completed': badgeClass = 'badge-success-subtle'; break;\n      case 'NC_Open': badgeClass = 'badge-danger-subtle'; break;\n      case 'Submitted_to_L2': badgeClass = 'badge-warning-subtle'; break; // Changed to warning for visibility\n      case 'NC_Pending_Verify': badgeClass = 'badge-warning-subtle'; break;\n      case 'Rejected': badgeClass = 'badge-danger-subtle'; break;\n      case 'Assigned': badgeClass = 'badge-primary-subtle'; break;\n      default: badgeClass = 'badge-info-subtle'; break;\n    }\n    return (\n      <Badge bg=\"light\" text=\"dark\" className={`badge-premium ${badgeClass} border-0`}>\n        {status.replace(/_/g, ' ')}\n      </Badge>\n    );\n  };\n\n  return (\n    <Container fluid className=\"py-4 fade-in px-0 px-md-3\">\n      <div className=\"d-flex justify-content-between align-items-center mb-4 px-3 px-md-0\">\n        <div>\n          <h2 className=\"fw-bold mb-1\">Administrator Dashboard</h2>\n          <p className=\"text-muted small mb-0\">Overview of all system activity.</p>\n        </div>\n      </div>\n\n      <Card className=\"border-0 shadow-sm rounded-4 overflow-hidden mb-5\">\n        <Card.Body className=\"p-0\">\n\n          {/* Mobile-Friendlier Search Bar */}\n          <div className=\"p-3 bg-light border-bottom\">\n            <div className=\"input-group\">\n              <span className=\"input-group-text bg-white border-end-0\"><FaSearch className=\"text-muted\" /></span>\n              <Form.Control\n                placeholder=\"Search audits...\"\n                className=\"border-start-0\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n            </div>\n          </div>\n\n          <div className=\"table-responsive\">\n            <Table hover className=\"mb-0 align-middle\">\n              <thead className=\"table-light\">\n                <tr>\n                  <th className=\"ps-4 py-3\">Date</th>\n                  <th className=\"py-3\">Machine / Asset</th>\n                  <th className=\"py-3\">Checklist Type</th>\n                  <th className=\"py-3 pe-4 text-center\">Status</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredAudits.map((a: any) => (\n                  <tr\n                    key={a.audit_id}\n                    onClick={() => handleRowClick(a)}\n                    style={{ cursor: 'pointer' }}\n                    className=\"hover-row\"\n                  >\n                    <td className=\"ps-4 text-nowrap\">{new Date(a.audit_date).toLocaleDateString()}</td>\n                    <td className=\"fw-medium text-dark\">{a.machine_name}</td>\n                    <td className=\"text-muted small text-uppercase\">{a.template_name?.replace(' Audit', '')}</td>\n                    <td className=\"text-center pe-4\">{getStatusBadge(a.status)}</td>\n                  </tr>\n                ))}\n                {filteredAudits.length === 0 && !loading && (\n                  <tr><td colSpan={4} className=\"text-center py-5 text-muted\">No audits found.</td></tr>\n                )}\n              </tbody>\n            </Table>\n          </div>\n        </Card.Body>\n      </Card>\n\n      <AuditDetailsModal\n        show={showDetailsModal}\n        onHide={() => setShowDetailsModal(false)}\n        audit={selectedAudit}\n        onDownloadExcel={handleExportExcel}\n        onDelete={handleDeleteRequest}\n        isDeleting={false} // Loading state handled globally for simplicity or add local state if needed\n      />\n\n      <ConfirmationModal\n        show={showDeleteConfirm}\n        onClose={() => setShowDeleteConfirm(false)}\n        onConfirm={handleDeleteConfirm}\n        title=\"Delete Audit\"\n        message=\"Are you sure you want to delete this audit? This action cannot be undone.\"\n        confirmText={deleting ? \"Deleting...\" : \"Delete\"}\n        variant=\"danger\"\n      />\n    </Container>\n  );\n};\n\nexport default AdminDashboard;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\DockAnalytics.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[574,577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[574,577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[731,734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[731,734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2877,2880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2877,2880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3114,3117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3114,3117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8267,8270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8267,8270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10781,10784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10781,10784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11019,11022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11019,11022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12092,12095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12092,12095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Container, Row, Col, Card, Button } from 'react-bootstrap';\nimport { FaCalendarAlt, FaCheckCircle, FaExclamationTriangle, FaTimesCircle } from 'react-icons/fa';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport { toast } from 'react-toastify';\nimport {\n    BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\n    PieChart, Pie, Cell\n} from 'recharts';\n\nconst DockAnalytics = () => {\n    const navigate = useNavigate();\n    const [stats, setStats] = useState<any>({\n        scheduled: 0,\n        completed: 0,\n        nc_total: 0,\n        rejected: 0,\n        monthly_trend: [] as any[],\n        nc_breakdown: [] as any[]\n    });\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        fetchStats();\n    }, []);\n\n    const fetchStats = async () => {\n        try {\n            const res = await api.get('/analytics/dock-sub');\n            setStats(res.data);\n        } catch {\n            toast.error(\"Failed to load analytics\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (loading) return (\n        <div className=\"d-flex justify-content-center align-items-center\" style={{ height: '80vh' }}>\n            <div className=\"text-center\">\n                <div className=\"spinner-grow text-primary mb-3\" role=\"status\"></div>\n                <p className=\"text-muted fw-bold\">Gathering Intelligence...</p>\n            </div>\n        </div>\n    );\n\n    const statCards = [\n        {\n            title: 'Scheduled',\n            value: stats.scheduled,\n            icon: <FaCalendarAlt size={20} />,\n            gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',\n            description: 'In progress'\n        },\n        {\n            title: 'Completed',\n            value: stats.completed,\n            icon: <FaCheckCircle size={20} />,\n            gradient: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',\n            description: 'Closed audits'\n        },\n        {\n            title: 'NCs Raised',\n            value: stats.nc_total,\n            icon: <FaExclamationTriangle size={20} />,\n            gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',\n            description: 'Non-conformances'\n        },\n        {\n            title: 'Rejected',\n            value: stats.rejected,\n            icon: <FaTimesCircle size={20} />,\n            gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',\n            description: 'Failed L2 review'\n        }\n    ];\n\n    const statusData = [\n        { name: 'Scheduled', value: stats.scheduled || 0 },\n        { name: 'Completed', value: stats.completed || 0 },\n        { name: 'Rejected', value: stats.rejected || 0 }\n    ];\n    const COLORS = ['#4facfe', '#43e97b', '#f5576c'];\n\n    const ncData = stats.nc_breakdown.map((item: any) => ({\n        name: item.status,\n        value: parseInt(item.count)\n    }));\n    const NC_COLORS = ['#fa709a', '#fee140', '#4facfe', '#43e97b'];\n\n    const CustomTooltip = ({ active, payload, label }: { active?: boolean; payload?: any[]; label?: string }) => {\n        if (active && payload && payload.length) {\n            return (\n                <div className=\"bg-white p-2 border-0 shadow-sm rounded\" style={{ borderLeft: `4px solid ${payload[0].fill}` }}>\n                    <p className=\"mb-0 small fw-bold text-dark\">{`${label || payload[0].name}: ${payload[0].value}`}</p>\n                </div>\n            );\n        }\n        return null;\n    };\n\n    return (\n        <Container fluid className=\"py-4\" style={{ backgroundColor: '#fcfdfe', minHeight: '100vh' }}>\n            <div className=\"mb-4\">\n                <Button variant=\"link\" className=\"text-decoration-none text-muted p-0 mb-3\" onClick={() => navigate('/admin/dashboard')}>\n                    ‚Üê Back to Dashboard\n                </Button>\n                <div className=\"d-flex justify-content-between align-items-end\">\n                    <div>\n                        <h2 className=\"fw-bold text-dark mb-1\">Audit Summary Dashboard</h2>\n                        <p className=\"text-muted mb-0 small uppercase tracking-wider\">Visual analytics & performance KPIs</p>\n                    </div>\n                </div>\n            </div>\n\n            <Row className=\"mb-4\">\n                {statCards.map((card, index) => (\n                    <Col key={index} xl={3} lg={6} className=\"mb-3\">\n                        <Card className=\"h-100 border-0 shadow-sm\" style={{ borderRadius: '12px', overflow: 'hidden' }}>\n                            <div style={{ height: '4px', background: card.gradient }}></div>\n                            <Card.Body className=\"p-4\">\n                                <div className=\"d-flex justify-content-between align-items-start mb-3\">\n                                    <div className=\"p-2 rounded-3\" style={{ background: `${card.gradient}20`, color: '#333' }}>\n                                        {card.icon}\n                                    </div>\n                                    <div className=\"text-end\">\n                                        <h6 className=\"text-uppercase text-muted fw-bold mb-1\" style={{ fontSize: '11px', letterSpacing: '0.5px' }}>{card.title}</h6>\n                                        <h3 className=\"fw-bold mb-0\">{card.value}</h3>\n                                    </div>\n                                </div>\n                                <p className=\"small text-muted mb-0 opacity-75\">{card.description}</p>\n                            </Card.Body>\n                        </Card>\n                    </Col>\n                ))}\n            </Row>\n\n            <Row>\n                <Col lg={8} className=\"mb-4\">\n                    <Card className=\"border-0 shadow-sm h-100\" style={{ borderRadius: '16px' }}>\n                        <Card.Header className=\"bg-white py-4 border-0\">\n                            <h6 className=\"mb-0 fw-bold text-indigo\">Monthly Completion Trend</h6>\n                        </Card.Header>\n                        <Card.Body className=\"p-4\" style={{ minHeight: '400px' }}>\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                <BarChart data={stats.monthly_trend}>\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f0f0f0\" />\n                                    <XAxis dataKey=\"month\" axisLine={false} tickLine={false} tick={{ fill: '#999', fontSize: 12 }} />\n                                    <YAxis allowDecimals={false} axisLine={false} tickLine={false} tick={{ fill: '#999', fontSize: 12 }} />\n                                    <Tooltip content={<CustomTooltip />} cursor={{ fill: '#f8f9fa' }} />\n                                    <Bar dataKey=\"count\" fill=\"#4facfe\" radius={[4, 4, 0, 0]} barSize={32} />\n                                </BarChart>\n                            </ResponsiveContainer>\n                        </Card.Body>\n                    </Card>\n                </Col>\n\n                <Col lg={4} className=\"mb-4\">\n                    <Card className=\"border-0 shadow-sm h-100\" style={{ borderRadius: '16px' }}>\n                        <Card.Header className=\"bg-white py-4 border-0\">\n                            <h6 className=\"mb-0 fw-bold text-indigo\">Audit Status Distribution</h6>\n                        </Card.Header>\n                        <Card.Body className=\"p-0 d-flex flex-column align-items-center justify-content-center\" style={{ minHeight: '350px' }}>\n                            <ResponsiveContainer width=\"100%\" height={260}>\n                                <PieChart>\n                                    <Pie\n                                        data={statusData}\n                                        cx=\"50%\"\n                                        cy=\"50%\"\n                                        innerRadius={60}\n                                        outerRadius={90}\n                                        paddingAngle={5}\n                                        dataKey=\"value\"\n                                        stroke=\"none\"\n                                    >\n                                        {statusData.map((_item: any, index: number) => (\n                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                                        ))}\n                                    </Pie>\n                                    <Tooltip content={<CustomTooltip />} />\n                                </PieChart>\n                            </ResponsiveContainer>\n                            <div className=\"w-100 px-4 mb-4\">\n                                {statusData.map((item, idx) => (\n                                    <div key={idx} className=\"d-flex justify-content-between align-items-center mb-2\">\n                                        <div className=\"d-flex align-items-center gap-2\">\n                                            <div style={{ width: '10px', height: '10px', borderRadius: '50%', backgroundColor: COLORS[idx] }}></div>\n                                            <span className=\"small text-muted fw-bold\">{item.name}</span>\n                                        </div>\n                                        <span className=\"small fw-bold\">{item.value}</span>\n                                    </div>\n                                ))}\n                            </div>\n                        </Card.Body>\n                    </Card>\n                </Col>\n\n                <Col lg={12} className=\"mb-4\">\n                    <Card className=\"border-0 shadow-sm\" style={{ borderRadius: '16px' }}>\n                        <Card.Header className=\"bg-white py-4 border-0\">\n                            <h6 className=\"mb-0 fw-bold text-indigo\">Non-Conformance (NC) Summary</h6>\n                        </Card.Header>\n                        <Card.Body className=\"p-4\">\n                            <Row className=\"align-items-center\">\n                                <Col md={6}>\n                                    <div style={{ height: '250px' }}>\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                            <PieChart>\n                                                <Pie\n                                                    data={ncData}\n                                                    cx=\"50%\"\n                                                    cy=\"50%\"\n                                                    outerRadius={80}\n                                                    dataKey=\"value\"\n                                                    label={({ name, percent }: any) => `${name} ${(percent * 100).toFixed(0)}%`}\n                                                    stroke=\"none\"\n                                                >\n                                                    {ncData.map((_item: any, index: number) => (\n                                                        <Cell key={`cell-${index}`} fill={NC_COLORS[index % NC_COLORS.length]} />\n                                                    ))}\n                                                </Pie>\n                                                <Tooltip content={<CustomTooltip />} />\n                                            </PieChart>\n                                        </ResponsiveContainer>\n                                    </div>\n                                </Col>\n                                <Col md={6}>\n                                    <div className=\"ps-md-4\">\n                                        <h5 className=\"fw-bold mb-3\">Resolution Quality</h5>\n                                        <p className=\"small text-muted mb-4\">Real-time status of corrective actions. Efficient NC closure reduces overall operational risk.</p>\n                                        <div className=\"d-flex flex-wrap gap-3\">\n                                            {ncData.map((nc: any, idx: number) => (\n                                                <div key={idx} className=\"bg-light p-3 rounded-3 border\" style={{ minWidth: '140px' }}>\n                                                    <div className=\"d-flex align-items-center gap-2 mb-1\">\n                                                        <div style={{ width: '8px', height: '8px', borderRadius: '50%', backgroundColor: NC_COLORS[idx] }}></div>\n                                                        <small className=\"text-muted text-uppercase fw-bold\" style={{ fontSize: '10px' }}>{nc.name}</small>\n                                                    </div>\n                                                    <div className=\"h4 fw-bold mb-0\">{nc.value}</div>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </Col>\n                            </Row>\n                        </Card.Body>\n                    </Card>\n                </Col>\n            </Row>\n        </Container>\n    );\n};\n\nexport default DockAnalytics;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\DockAuditPlan.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6494,6497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6494,6497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from 'react';\nimport { Container, Table, Badge, Form, Modal, Button, Stack, Card } from 'react-bootstrap';\nimport { dockApi } from '../../api/dock';\nimport { useAuth } from '../../hooks/useAuth';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport { toast } from 'react-toastify';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport Skeleton from '../../components/common/Skeleton';\nimport { FaEdit, FaPlus, FaTrash, FaDownload, FaTimes } from 'react-icons/fa';\n\nconst months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\ninterface Audit {\n    audit_id: string;\n    audit_date: string;\n    status: string;\n    part_name: string;\n    machine_name?: string;\n}\n\ninterface Plan {\n    part_family: string;\n    month: string;\n    week_1_plan?: boolean;\n    week_2_plan?: boolean;\n    week_3_plan?: boolean;\n    week_4_plan?: boolean;\n}\n\nconst DockAuditPlan = () => {\n    const { user } = useAuth();\n    const navigate = useNavigate();\n    const [actualAudits, setActualAudits] = useState<Audit[]>([]);\n    const [plannedAudits, setPlannedAudits] = useState<Plan[]>([]);\n    const [products, setProducts] = useState<string[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [year, setYear] = useState(new Date().getFullYear());\n\n    // Rescheduling & Manual Scheduling State\n    const [editDateAudit, setEditDateAudit] = useState<Audit | null>(null);\n    const [newDate, setNewDate] = useState<string>('');\n    const [scheduleConfirm, setScheduleConfirm] = useState<{ product: string, month: string, week: number } | null>(null);\n    const [deleteAuditConfirm, setDeleteAuditConfirm] = useState<string | null>(null);\n\n    // Product Management State\n    const [showAddModal, setShowAddModal] = useState(false);\n    const [newProductName, setNewProductName] = useState('');\n    const [deleteProductConfirm, setDeleteProductConfirm] = useState<string | null>(null);\n\n    useEffect(() => {\n        fetchData();\n    }, [year, fetchData]);\n\n    const fetchData = useCallback(async () => {\n        setLoading(true);\n        try {\n            const [pRes, prodList] = await Promise.all([\n                dockApi.getPlan(year),\n                dockApi.getProducts()\n            ]);\n            setActualAudits(pRes.actuals);\n            setPlannedAudits(pRes.plan);\n            setProducts(prodList);\n        } catch {\n            toast.error(\"Failed to load dock audit plan\");\n        } finally {\n            setLoading(false);\n        }\n    }, [year]);\n\n    const handleUpdateDate = async () => {\n        if (!editDateAudit || !newDate) return;\n        try {\n            await api.patch(`/audits/${editDateAudit.audit_id}/dates`, { audit_date: newDate });\n            toast.success('Audit date updated!');\n            fetchData();\n            setEditDateAudit(null);\n        } catch {\n            toast.error('Failed to update audit date');\n        }\n    };\n\n    const togglePlan = async (product: string, month: string, week: number, currentVal: boolean) => {\n        if (user?.role !== 'Admin') return;\n        try {\n            await dockApi.updatePlan(product, month, year, week, !currentVal);\n            fetchData();\n        } catch {\n            toast.error(\"Failed to update plan\");\n        }\n    };\n\n    const handleDeleteAudit = async () => {\n        if (!deleteAuditConfirm) return;\n        try {\n            await api.delete(`/audits/${deleteAuditConfirm}`);\n            toast.success('Audit deleted successfully');\n            setDeleteAuditConfirm(null);\n            fetchData();\n        } catch {\n            toast.error('Failed to delete audit');\n        }\n    };\n\n    const handleSchedule = async () => {\n        if (!scheduleConfirm) return;\n        const { product, month, week } = scheduleConfirm;\n        try {\n            const tRes = await api.get('/templates');\n            const template = tRes.data.find((t: { template_name: string; template_id: string }) => t.template_name === 'Dock Audit');\n            if (!template) {\n                toast.error('Dock Audit Template not found');\n                return;\n            }\n\n            // Calculate a default date for the selected week\n            const monthIdx = months.indexOf(month);\n            const day = (week - 1) * 7 + 5;\n            const audit_date = new Date(year, monthIdx, day).toISOString().split('T')[0];\n\n            const l1Res = await api.get('/users?role=L1_Auditor');\n            const l2Res = await api.get('/users?role=L2_Auditor');\n            const poRes = await api.get('/users?role=Process_Owner');\n\n            const newAuditRes = await api.post('/audits/schedule', {\n                template_id: template.template_id,\n                machine_name: 'DOCK-AREA',\n                audit_date: audit_date,\n                shift: 'A',\n                l1_auditor_id: l1Res.data?.[0]?.user_id || user?.user_id,\n                l2_auditor_id: l2Res.data?.[0]?.user_id || user?.user_id,\n                process_owner_id: poRes.data?.[0]?.user_id || user?.user_id,\n                operation: 'Dock Audit',\n                part_name: product,\n                part_number: 'N/A',\n            });\n\n            toast.success('Manual Audit Scheduled!');\n            fetchData();\n            navigate(`/l1/audit/${newAuditRes.data.audit_id}`);\n        } catch {\n            toast.error('Failed to schedule audit');\n        } finally {\n            setScheduleConfirm(null);\n        }\n    };\n\n    const handleAddProduct = async () => {\n        if (!newProductName.trim()) return;\n        try {\n            await dockApi.addProduct(newProductName.trim());\n            toast.success('Product added successfully');\n            setNewProductName('');\n            setShowAddModal(false);\n            fetchData();\n        } catch {\n            toast.error('Failed to add product');\n        }\n    };\n\n    const handleDeleteProduct = async () => {\n        if (!deleteProductConfirm) return;\n        try {\n            await dockApi.deleteProduct(deleteProductConfirm);\n            toast.success('Product deleted successfully');\n            setDeleteProductConfirm(null);\n            fetchData();\n        } catch {\n            toast.error('Failed to delete product');\n        }\n    };\n\n    const handleExportCSV = () => {\n        try {\n            const headers = ['Product', 'Type', ...months.map(m => `${m}-${year % 100}`)];\n            const rows: any[][] = [];\n            products.forEach(prod => {\n                const planRow = [prod, 'Plan'];\n                months.forEach(m => {\n                    const planEntry = plannedAudits.find(p => p.part_family === prod && p.month === m);\n                    if (planEntry) {\n                        const plannedWeeks = [];\n                        if (planEntry.week_1_plan) plannedWeeks.push('W1');\n                        if (planEntry.week_2_plan) plannedWeeks.push('W2');\n                        if (planEntry.week_3_plan) plannedWeeks.push('W3');\n                        if (planEntry.week_4_plan) plannedWeeks.push('W4');\n                        planRow.push(plannedWeeks.join(', ') || '-');\n                    } else {\n                        planRow.push('-');\n                    }\n                });\n                rows.push(planRow);\n                const actualRow = [prod, 'Actual'];\n                months.forEach(m => {\n                    const monthIdx = months.indexOf(m);\n                    const actuals = actualAudits.filter((a: Audit) => {\n                        const date = new Date(a.audit_date);\n                        return a.part_name?.toLowerCase().trim() === prod.toLowerCase().trim() &&\n                            date.getMonth() === monthIdx &&\n                            date.getFullYear() === year;\n                    });\n                    actualRow.push(actuals.map((a: Audit) => new Date(a.audit_date).getDate()).join(', ') || '-');\n                });\n                rows.push(actualRow);\n            });\n            const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n            const link = document.createElement('a');\n            const url = URL.createObjectURL(blob);\n            link.setAttribute('href', url);\n            link.setAttribute('download', `Dock_Audit_Plan_${year}.csv`);\n            link.style.visibility = 'hidden';\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            toast.success('CSV Downloaded!');\n        } catch {\n            toast.error('Failed to export CSV');\n        }\n    };\n\n    const renderPlanCell = (product: string, month: string) => {\n        const p = plannedAudits.find(entry => entry.part_family === product && entry.month === month);\n        return (\n            <div className=\"d-flex flex-wrap gap-1 justify-content-center px-1\">\n                {[1, 2, 3, 4].map(w => {\n                    const isPlanned = p?.[`week_${w}_plan` as keyof typeof p];\n                    return (\n                        <Badge\n                            key={w}\n                            bg={isPlanned ? \"primary\" : \"white\"}\n                            className={`cursor-pointer border py-1 px-2 ${!isPlanned ? 'text-muted opacity-25' : 'shadow-sm'}`}\n                            style={{ fontSize: '9px', minWidth: '35px' }}\n                            onClick={() => togglePlan(product, month, w, !!isPlanned)}\n                        >\n                            W-{w}\n                        </Badge>\n                    );\n                })}\n            </div>\n        );\n    };\n\n    const renderActualCell = (product: string, month: string) => {\n        const monthIdx = months.indexOf(month);\n        const actuals = actualAudits.filter((a: Audit) => {\n            const date = new Date(a.audit_date);\n            return a.part_name?.toLowerCase().trim() === product.toLowerCase().trim() &&\n                date.getMonth() === monthIdx &&\n                date.getFullYear() === year;\n        });\n\n        return (\n            <div className=\"d-flex flex-wrap justify-content-center gap-1 align-items-center\">\n                {actuals.map((a: Audit) => (\n                    <div key={a.audit_id} className=\"position-relative d-inline-block\">\n                        <Badge\n                            pill\n                            bg={a.status === 'Completed' ? \"success\" : \"warning\"}\n                            className=\"cursor-pointer d-flex align-items-center gap-1\"\n                            style={{ fontSize: '10px', padding: '5px 8px' }}\n                            onClick={() => navigate(`/l1/audit/${a.audit_id}`)}\n                        >\n                            {new Date(a.audit_date).getDate()}\n                        </Badge>\n                        {user?.role === 'Admin' && (\n                            <>\n                                <div\n                                    className=\"position-absolute bg-primary text-white rounded-circle d-flex align-items-center justify-content-center cursor-pointer shadow-sm hover-scale transition-all\"\n                                    style={{\n                                        top: '-6px',\n                                        right: '10px',\n                                        width: '16px',\n                                        height: '16px',\n                                        fontSize: '8px',\n                                        border: '1px solid white',\n                                        zIndex: 10\n                                    }}\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        setEditDateAudit(a);\n                                        setNewDate(new Date(a.audit_date).toISOString().split('T')[0]);\n                                    }}\n                                >\n                                    <FaEdit />\n                                </div>\n                                <div\n                                    className=\"position-absolute bg-danger text-white rounded-circle d-flex align-items-center justify-content-center cursor-pointer shadow-sm hover-scale transition-all\"\n                                    style={{\n                                        top: '-6px',\n                                        right: '-6px',\n                                        width: '16px',\n                                        height: '16px',\n                                        fontSize: '8px',\n                                        border: '1px solid white',\n                                        zIndex: 10\n                                    }}\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        setDeleteAuditConfirm(a.audit_id);\n                                    }}\n                                >\n                                    <FaTimes />\n                                </div>\n                            </>\n                        )}\n                    </div>\n                ))}\n                {/* Manual scheduling removed per user request */}\n            </div>\n        );\n    };\n\n    const renderSummaryTable = () => {\n        const summaryData = months.map((m) => {\n            const monthIdx = months.indexOf(m);\n            const actualForMonth = actualAudits.filter(a => {\n                const date = new Date(a.audit_date);\n                return date.getMonth() === monthIdx && date.getFullYear() === year && a.status === 'Completed';\n            }).length;\n\n            // Count weekly plans across all products\n            const plannedCount = products.reduce((acc, prod) => {\n                const p = plannedAudits.find(entry => entry.part_family === prod && entry.month === m);\n                let count = 0;\n                if (p?.week_1_plan) count++;\n                if (p?.week_2_plan) count++;\n                if (p?.week_3_plan) count++;\n                if (p?.week_4_plan) count++;\n                return acc + count;\n            }, 0);\n\n            return { month: m, plan: plannedCount, actual: actualForMonth, nc: 0 };\n        });\n\n        const totalPlan = summaryData.reduce((acc, curr) => acc + curr.plan, 0);\n        const totalActual = summaryData.reduce((acc, curr) => acc + curr.actual, 0);\n\n        return (\n            <Card className=\"mt-5 border-0 shadow-sm overflow-hidden rounded-4\" style={{ maxWidth: '600px' }}>\n                <Card.Header className=\"bg-white py-3 border-bottom d-flex justify-content-between align-items-center\">\n                    <h5 className=\"mb-0 fw-bold\">Dock Audit Summary - {year}</h5>\n                    <Badge bg=\"primary-light\" className=\"text-primary px-3 py-2\">\n                        Annual Performance Check\n                    </Badge>\n                </Card.Header>\n                <Table responsive hover className=\"mb-0 text-center align-middle\">\n                    <thead className=\"bg-light\">\n                        <tr>\n                            <th className=\"py-3 text-uppercase small fw-bold text-dark\">Metric</th>\n                            {months.map(m => (\n                                <th key={m} className=\"py-3 text-uppercase small fw-bold text-dark\">{m}</th>\n                            ))}\n                            <th className=\"py-3 text-uppercase small fw-bold text-primary\">Total</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            <td className=\"fw-bold text-muted small text-start ps-4\">TOTAL PLAN</td>\n                            {summaryData.map((d, i) => (\n                                <td key={i}>{d.plan}</td>\n                            ))}\n                            <td className=\"fw-bold text-primary\">{totalPlan}</td>\n                        </tr>\n                        <tr>\n                            <td className=\"fw-bold text-muted small text-start ps-4\">TOTAL ACTUAL</td>\n                            {summaryData.map((d, i) => (\n                                <td key={i}>{d.actual}</td>\n                            ))}\n                            <td className=\"fw-bold text-success\">{totalActual}</td>\n                        </tr>\n                        <tr className=\"bg-light-subtle\">\n                            <td className=\"fw-bold text-muted small text-start ps-4\">COMPLIANCE</td>\n                            {summaryData.map((d, i) => {\n                                const rate = d.plan > 0 ? Math.round((d.actual / d.plan) * 100) : 0;\n                                return (\n                                    <td key={i} className={`fw-bold ${rate >= 100 ? 'text-success' : rate >= 50 ? 'text-warning' : 'text-danger'}`}>\n                                        {rate}%\n                                    </td>\n                                );\n                            })}\n                            <td className=\"fw-bold text-dark\">\n                                {totalPlan > 0 ? Math.round((totalActual / totalPlan) * 100) : 0}%\n                            </td>\n                        </tr>\n                    </tbody>\n                </Table>\n            </Card>\n        );\n    };\n\n    if (loading && products.length === 0) {\n        return (\n            <Container fluid className=\"p-4\">\n                <Skeleton height=\"100px\" className=\"mb-4\" />\n                <Skeleton height=\"400px\" />\n            </Container>\n        );\n    }\n\n    return (\n        <Container fluid className=\"p-4 fade-in\">\n            <Stack direction=\"horizontal\" gap={3} className=\"mb-4 align-items-center\">\n                <div>\n                    <h3 className=\"fw-bold text-gradient mb-1\">Dock Audit Management</h3>\n                    <p className=\"text-muted small mb-0\">Global product compliance tracking and scheduling.</p>\n                </div>\n                <div className=\"ms-auto d-flex gap-2\">\n                    {user?.role === 'Admin' && (\n                        <Button variant=\"outline-primary\" onClick={() => setShowAddModal(true)} className=\"d-flex align-items-center gap-2 px-3 shadow-xs\">\n                            <FaPlus /> Add Product\n                        </Button>\n                    )}\n                    <Button variant=\"success\" onClick={handleExportCSV} className=\"d-flex align-items-center gap-2 px-4 shadow-xs\">\n                        <FaDownload /> Export CSV\n                    </Button>\n                    <Form.Select\n                        value={year}\n                        onChange={(e) => setYear(parseInt(e.target.value))}\n                        className=\"w-auto border-0 bg-light shadow-xs fw-bold\"\n                    >\n                        {[2024, 2025, 2026].map(y => (\n                            <option key={y} value={y}>{y}</option>\n                        ))}\n                    </Form.Select>\n                </div>\n            </Stack>\n\n            <Card className=\"border-0 shadow-sm overflow-hidden rounded-4\">\n                <div className=\"table-responsive\">\n                    <Table bordered hover size=\"sm\" className=\"text-center align-middle mb-0 table-premium\">\n                        <thead className=\"table-light\">\n                            <tr>\n                                <th rowSpan={2} className=\"sticky-col py-3 border-end bg-light\" style={{ width: '220px', minWidth: '220px', maxWidth: '220px', verticalAlign: 'middle', left: 0 }}>Part Nomenclature</th>\n                                <th rowSpan={2} className=\"sticky-col bg-light border-end sticky-col-shadow\" style={{ width: '80px', minWidth: '80px', maxWidth: '80px', verticalAlign: 'middle', left: '220px' }}>Scope</th>\n                                {months.map(m => (\n                                    <th key={m} className=\"py-3 small fw-bold text-uppercase tracking-wider\" style={{ minWidth: '110px' }}>{m}-{year % 100}</th>\n                                ))}\n                            </tr>\n                            <tr>\n                                {months.map(m => <th key={`${m}-sub`} className=\"p-0 border-0\" style={{ height: '0px' }}></th>)}\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {products.map(prod => (\n                                <React.Fragment key={prod}>\n                                    <tr>\n                                        <td rowSpan={2} className=\"sticky-col fw-bold text-start ps-4 align-middle bg-white border-end\" style={{ left: 0, width: '220px', minWidth: '220px', maxWidth: '220px' }}>\n                                            <div className=\"d-flex justify-content-between align-items-center\">\n                                                <span className=\"text-truncate\" style={{ maxWidth: '160px' }}>{prod}</span>\n                                                {user?.role === 'Admin' && (\n                                                    <FaTrash\n                                                        className=\"text-danger cursor-pointer opacity-25 hover-opacity-100 transition-all\"\n                                                        size={12}\n                                                        onClick={() => setDeleteProductConfirm(prod)}\n                                                    />\n                                                )}\n                                            </div>\n                                        </td>\n                                        <td className=\"sticky-col small text-primary bg-light border-end py-2 fw-bold sticky-col-shadow\" style={{ left: '220px', width: '80px', minWidth: '80px', maxWidth: '80px' }}>PLAN</td>\n                                        {months.map(m => (\n                                            <td key={`${prod}-${m}-plan`} className=\"p-2 border-bottom-dashed\">\n                                                {renderPlanCell(prod, m)}\n                                            </td>\n                                        ))}\n                                    </tr>\n                                    <tr>\n                                        <td className=\"sticky-col small text-dark bg-light border-end py-2 fw-bold sticky-col-shadow\" style={{ left: '220px', width: '80px', minWidth: '80px', maxWidth: '80px' }}>ACTUAL</td>\n                                        {months.map(m => (\n                                            <td key={`${prod}-${m}-actual`} className=\"p-2\">\n                                                {renderActualCell(prod, m)}\n                                            </td>\n                                        ))}\n                                    </tr>\n                                </React.Fragment>\n                            ))}\n                        </tbody>\n                    </Table>\n                </div>\n            </Card>\n\n            {renderSummaryTable()}\n\n            <Modal show={!!editDateAudit} onHide={() => setEditDateAudit(null)} centered>\n                <Modal.Header closeButton><Modal.Title>Reschedule Audit</Modal.Title></Modal.Header>\n                <Modal.Body>\n                    <Form.Group>\n                        <Form.Label className=\"small fw-bold\">New Date for {editDateAudit?.part_name}</Form.Label>\n                        <Form.Control type=\"date\" value={newDate} onChange={(e) => setNewDate(e.target.value)} />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"light\" onClick={() => setEditDateAudit(null)}>Cancel</Button>\n                    <Button variant=\"primary\" onClick={handleUpdateDate}>Update Schedule</Button>\n                </Modal.Footer>\n            </Modal>\n\n            <ConfirmationModal\n                show={!!scheduleConfirm}\n                onClose={() => setScheduleConfirm(null)}\n                onConfirm={handleSchedule}\n                title=\"Manual Audit Insertion\"\n                message={`Schedule an unscheduled Dock Audit for ${scheduleConfirm?.product} in ${scheduleConfirm?.month}?`}\n                confirmText=\"Insert Audit\"\n                variant=\"primary\"\n            />\n\n            <ConfirmationModal\n                show={!!deleteAuditConfirm}\n                onClose={() => setDeleteAuditConfirm(null)}\n                onConfirm={handleDeleteAudit}\n                title=\"Discard Historical Protocol\"\n                message=\"Are you sure you want to permanently delete this audit record? All associated checklist data and Non-Conformances will be lost.\"\n                confirmText=\"Permanently Delete\"\n                variant=\"danger\"\n            />\n\n            <Modal show={showAddModal} onHide={() => setShowAddModal(false)} centered>\n                <Modal.Header closeButton><Modal.Title>Register New Product</Modal.Title></Modal.Header>\n                <Modal.Body>\n                    <Form.Group>\n                        <Form.Label className=\"small fw-bold\">Product Nomenclature</Form.Label>\n                        <Form.Control type=\"text\" placeholder=\"SERRATED FY\" value={newProductName} onChange={(e) => setNewProductName(e.target.value)} />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"light\" onClick={() => setShowAddModal(false)}>Cancel</Button>\n                    <Button variant=\"primary\" onClick={handleAddProduct} disabled={!newProductName.trim()}>Confirm Registry</Button>\n                </Modal.Footer>\n            </Modal>\n\n            <ConfirmationModal\n                show={!!deleteProductConfirm}\n                onClose={() => setDeleteProductConfirm(null)}\n                onConfirm={handleDeleteProduct}\n                title=\"Remove Product\"\n                message={`Unregister \"${deleteProductConfirm}\" from the global audit plan?`}\n                confirmText=\"Unregister\"\n                variant=\"danger\"\n            />\n        </Container>\n    );\n};\n\nexport default DockAuditPlan;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\ManufacturingProductAuditPlan.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6841,6844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6841,6844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback } from 'react';\nimport { Container, Table, Badge, Form, Modal, Button, Card } from 'react-bootstrap';\nimport { mfgApi } from '../../api/mfg';\nimport api from '../../api/axios';\nimport { useAuth } from '../../hooks/useAuth';\nimport Skeleton from '../../components/common/Skeleton';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport { FaEdit, FaPlus, FaTrash, FaDownload, FaTimes } from 'react-icons/fa';\n\nconst months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\ninterface MfgAudit {\n    audit_id: string;\n    audit_date: string;\n    status: string;\n    part_name: string;\n    machine_name?: string;\n}\n\ninterface MfgPlan {\n    part_family: string;\n    month: string;\n    week_1_plan?: boolean;\n    week_2_plan?: boolean;\n    week_3_plan?: boolean;\n    week_4_plan?: boolean;\n}\n\nconst ManufacturingProductAuditPlan = () => {\n    const { user } = useAuth();\n    const navigate = useNavigate();\n    const [actuals, setActuals] = useState<MfgAudit[]>([]);\n    const [plans, setPlans] = useState<MfgPlan[]>([]);\n    const [products, setProducts] = useState<string[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [year, setYear] = useState(2026);\n    const [quarter, setQuarter] = useState<string>('All');\n\n    // UI State for Modals\n    const [showAddModal, setShowAddModal] = useState(false);\n    const [newProductName, setNewProductName] = useState('');\n    const [deleteProductConfirm, setDeleteProductConfirm] = useState<string | null>(null);\n    const [deleteAuditConfirm, setDeleteAuditConfirm] = useState<string | null>(null);\n\n    // Rescheduling & Manual Scheduling State\n    const [editDateAudit, setEditDateAudit] = useState<MfgAudit | null>(null);\n    const [newDate, setNewDate] = useState<string>('');\n    const [scheduleConfirm, setScheduleConfirm] = useState<{ product: string, month: string, week: number } | null>(null);\n\n    // Filter months based on quarter\n    const filteredMonths = quarter === 'All'\n        ? months\n        : months.slice((parseInt(quarter) - 1) * 3, parseInt(quarter) * 3);\n\n    useEffect(() => {\n        fetchData();\n    }, [fetchData]);\n\n    const fetchData = useCallback(async () => {\n        setLoading(true);\n        try {\n            const [data, prodList] = await Promise.all([\n                mfgApi.getPlan(year),\n                mfgApi.getProducts()\n            ]);\n            setActuals(data.actuals);\n            setPlans(data.plan);\n            setProducts(prodList);\n        } catch {\n            toast.error(\"Failed to load manufacturing audit plan\");\n        } finally {\n            setLoading(false);\n        }\n    }, [year]);\n\n    const handleDeleteAudit = async () => {\n        if (!deleteAuditConfirm) return;\n        try {\n            await api.delete(`/audits/${deleteAuditConfirm}`);\n            toast.success('Audit deleted successfully');\n            setDeleteAuditConfirm(null);\n            fetchData();\n        } catch {\n            toast.error('Failed to delete audit');\n        }\n    };\n\n    const handleUpdateDate = async () => {\n        if (!editDateAudit || !newDate) return;\n        try {\n            await api.patch(`/audits/${editDateAudit.audit_id}/dates`, { audit_date: newDate });\n            toast.success('Audit rescheduled successfully!');\n            fetchData();\n            setEditDateAudit(null);\n        } catch {\n            toast.error('Failed to update audit date');\n        }\n    };\n\n    const handleSchedule = async () => {\n        if (!scheduleConfirm) return;\n        const { product, month, week } = scheduleConfirm;\n        try {\n            const tRes = await api.get('/templates');\n            const template = tRes.data.find((t: { template_name: string; template_id: string }) => t.template_name.toLowerCase().includes('manufacturing'));\n            if (!template) {\n                toast.error('Manufacturing Template not found');\n                return;\n            }\n\n            // Calculate a default date for the selected week\n            const monthIdx = months.indexOf(month);\n            const day = (week - 1) * 7 + 5;\n            const audit_date = new Date(year, monthIdx, day).toISOString().split('T')[0];\n\n            const l1Res = await api.get('/users?role=L1_Auditor');\n            const l2Res = await api.get('/users?role=L2_Auditor');\n            const poRes = await api.get('/users?role=Process_Owner');\n\n            const newAuditRes = await api.post('/audits/schedule', {\n                template_id: template.template_id,\n                machine_name: product,\n                audit_date: audit_date,\n                shift: 'A',\n                l1_auditor_id: l1Res.data?.[0]?.user_id || user?.user_id,\n                l2_auditor_id: l2Res.data?.[0]?.user_id || user?.user_id,\n                process_owner_id: poRes.data?.[0]?.user_id || user?.user_id,\n                operation: 'Scheduled Manually',\n                part_name: product,\n                part_number: 'REF-PLAN',\n                process: product, // Using Product Name as Process Name per user request to \"use any logic\"\n            });\n\n            toast.success('Manual Audit Scheduled!');\n            fetchData();\n            navigate(`/l1/audit/${newAuditRes.data.audit_id}`);\n        } catch {\n            toast.error('Failed to schedule audit');\n        } finally {\n            setScheduleConfirm(null);\n        }\n    };\n\n    const handleAddProduct = async () => {\n        if (!newProductName.trim()) return;\n        try {\n            await mfgApi.addProduct(newProductName.trim());\n            toast.success('Product added successfully');\n            setNewProductName('');\n            setShowAddModal(false);\n            fetchData();\n        } catch {\n            toast.error('Failed to add product');\n        }\n    };\n\n    const handleDeleteProduct = async () => {\n        if (!deleteProductConfirm) return;\n        try {\n            await mfgApi.deleteProduct(deleteProductConfirm);\n            toast.success('Product deleted successfully');\n            setDeleteProductConfirm(null);\n            fetchData();\n        } catch {\n            toast.error('Failed to delete product');\n        }\n    };\n\n    const togglePlan = async (product: string, month: string, week: number, currentVal: boolean) => {\n        if (user?.role !== 'Admin') return;\n        try {\n            await mfgApi.updatePlan(product, month, year, week, !currentVal);\n            fetchData();\n        } catch {\n            toast.error(\"Failed to update plan\");\n        }\n    };\n\n    const handleExportCSV = () => {\n        try {\n            const headers = ['Product', 'Type', ...months.map(m => `${m}-${year % 100}`)];\n            const rows: any[][] = [];\n            products.forEach(prod => {\n                const planRow = [prod, 'Plan'];\n                months.forEach(m => {\n                    const monthPlans = plans.filter(p => p.part_family === prod && p.month === m);\n                    let planStr = '';\n                    if (monthPlans.some(p => p.week_1_plan)) planStr += 'W-1 ';\n                    if (monthPlans.some(p => p.week_2_plan)) planStr += 'W-2 ';\n                    if (monthPlans.some(p => p.week_3_plan)) planStr += 'W-3 ';\n                    if (monthPlans.some(p => p.week_4_plan)) planStr += 'W-4 ';\n                    planRow.push(planStr.trim() || '-');\n                });\n                rows.push(planRow);\n                const actualRow = [prod, 'Actual'];\n                months.forEach(m => {\n                    const monthIdx = months.indexOf(m);\n                    const prodActuals = actuals.filter(a => {\n                        const date = new Date(a.audit_date);\n                        return a.part_name?.trim() === prod.trim() && date.getMonth() === monthIdx;\n                    });\n                    actualRow.push(prodActuals.map(a => new Date(a.audit_date).getDate()).join(' & ') || '-');\n                });\n                rows.push(actualRow);\n            });\n            const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\\n');\n            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(blob);\n            link.setAttribute('download', `Manufacturing_Audit_Plan_${year}.csv`);\n            link.click();\n        } catch {\n            toast.error('Export failed');\n        }\n    };\n\n    if (loading) {\n        return (\n            <Container fluid className=\"py-4\">\n                <Skeleton height={60} borderRadius=\"1rem\" className=\"mb-4\" />\n                <Card className=\"border-0 shadow-sm rounded-4 overflow-hidden\">\n                    <Card.Body className=\"p-0\">\n                        {[1, 2, 3, 4, 5, 6].map(i => (\n                            <div key={i} className=\"p-4 border-bottom d-flex gap-4\">\n                                <Skeleton width={150} height={20} />\n                                <Skeleton height={20} />\n                                <Skeleton width={100} height={20} />\n                            </div>\n                        ))}\n                    </Card.Body>\n                </Card>\n            </Container>\n        );\n    }\n\n    return (\n        <Container fluid className=\"py-4 fade-in\">\n            <div className=\"d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4\">\n                <div>\n                    <h3 className=\"fw-bold text-gradient mb-1\">Industrial Audit Management</h3>\n                    <p className=\"text-muted small mb-0\">Strategic quality scheduling across multiple manufacturing cycles.</p>\n                </div>\n                <div className=\"d-flex flex-wrap gap-2 align-items-center\">\n                    <Form.Select\n                        size=\"sm\"\n                        value={quarter}\n                        onChange={(e) => setQuarter(e.target.value)}\n                        className=\"rounded-3 fw-bold border-1 shadow-xs\"\n                        style={{ width: '130px' }}\n                    >\n                        <option value=\"All\">Full Year</option>\n                        <option value=\"1\">Q1 (Jan-Mar)</option>\n                        <option value=\"2\">Q2 (Apr-Jun)</option>\n                        <option value=\"3\">Q3 (Jul-Sep)</option>\n                        <option value=\"4\">Q4 (Oct-Dec)</option>\n                    </Form.Select>\n                    <Form.Select\n                        size=\"sm\"\n                        value={year}\n                        onChange={(e) => setYear(parseInt(e.target.value))}\n                        className=\"rounded-3 fw-bold border-1 shadow-xs\"\n                        style={{ width: '100px' }}\n                    >\n                        {[2025, 2026, 2027].map(y => <option key={y} value={y}>{y}</option>)}\n                    </Form.Select>\n                    {user?.role === 'Admin' && (\n                        <>\n                            <Button variant=\"white\" size=\"sm\" className=\"border shadow-sm rounded-3 px-3 py-2 d-flex align-items-center gap-2 transition-all fw-bold ms-md-2\" onClick={() => setShowAddModal(true)}>\n                                <FaPlus size={12} className=\"text-primary\" /> <span className=\"d-none d-sm-inline\">Add Product</span>\n                            </Button>\n                            <Button variant=\"white\" size=\"sm\" className=\"border shadow-sm rounded-3 px-3 py-2 d-flex align-items-center gap-2 transition-all fw-bold\" onClick={handleExportCSV}>\n                                <FaDownload size={12} className=\"text-success\" /> <span className=\"d-none d-sm-inline\">Export CSV</span>\n                            </Button>\n                        </>\n                    )}\n                </div>\n            </div>\n\n            <Card className=\"shadow-sm border-0 rounded-4 overflow-hidden mb-5\">\n                <div className=\"table-responsive\">\n                    <Table bordered hover size=\"sm\" className=\"text-center align-middle mb-0 table-premium\">\n                        <thead>\n                            <tr className=\"bg-light\">\n                                <th rowSpan={2} className=\"sticky-col py-3 border-end bg-light\" style={{ width: '220px', minWidth: '220px', maxWidth: '220px', verticalAlign: 'middle', left: 0 }}>Part Nomenclature</th>\n                                <th rowSpan={2} className=\"sticky-col bg-light border-end sticky-col-shadow\" style={{ width: '80px', minWidth: '80px', maxWidth: '80px', verticalAlign: 'middle', left: '220px' }}>Scope</th>\n                                {filteredMonths.map(m => (\n                                    <th key={m} className=\"py-3 small fw-bold text-uppercase tracking-wider\" style={{ minWidth: '110px' }}>{m}-{year % 100}</th>\n                                ))}\n                            </tr>\n                        </thead>\n                        <tbody>\n                            {products.map(prod => (\n                                <React.Fragment key={prod}>\n                                    <tr>\n                                        <td rowSpan={2} className=\"sticky-col fw-bold text-start ps-4 align-middle bg-white border-end\" style={{ left: 0, width: '220px', minWidth: '220px', maxWidth: '220px' }}>\n                                            <div className=\"d-flex justify-content-between align-items-center\">\n                                                <span className=\"text-indigo text-truncate\" style={{ maxWidth: '160px' }}>{prod}</span>\n                                                {user?.role === 'Admin' && (\n                                                    <FaTrash\n                                                        className=\"text-danger cursor-pointer opacity-25 hover-opacity-100 transition-all\"\n                                                        size={12}\n                                                        onClick={() => setDeleteProductConfirm(prod)}\n                                                    />\n                                                )}\n                                            </div>\n                                        </td>\n                                        <td className=\"sticky-col small text-primary bg-light border-end py-2 fw-bold sticky-col-shadow\" style={{ fontSize: '0.65rem', left: '220px', width: '80px', minWidth: '80px', maxWidth: '80px' }}>PLAN</td>\n                                        {filteredMonths.map(m => {\n                                            const p = plans.find(entry => entry.part_family === prod && entry.month === m);\n                                            return (\n                                                <td key={`${prod}-${m}-plan`} className=\"p-2 border-bottom-dashed bg-white\">\n                                                    <div className=\"d-flex flex-wrap gap-1 justify-content-center px-1\">\n                                                        {[1, 2, 3, 4].map(w => {\n                                                            const isPlanned = p?.[`week_${w}_plan` as keyof typeof p];\n                                                            return (\n                                                                <Badge\n                                                                    key={w}\n                                                                    bg={isPlanned ? \"primary\" : \"white\"}\n                                                                    className={`cursor-pointer border py-1 px-2 ${!isPlanned ? 'text-muted opacity-25' : 'shadow-sm'}`}\n                                                                    style={{ fontSize: '9px', minWidth: '35px' }}\n                                                                    onClick={() => togglePlan(prod, m, w, !!isPlanned)}\n                                                                >\n                                                                    W-{w}\n                                                                </Badge>\n                                                            );\n                                                        })}\n                                                    </div>\n                                                </td>\n                                            );\n                                        })}\n                                    </tr>\n                                    <tr>\n                                        <td className=\"sticky-col small text-dark bg-light border-end py-2 fw-bold sticky-col-shadow\" style={{ fontSize: '0.65rem', left: '220px', width: '80px', minWidth: '80px', maxWidth: '80px' }}>ACTUAL</td>\n                                        {filteredMonths.map(m => {\n                                            const monthIdx = months.indexOf(m);\n                                            const prodActuals = actuals.filter(a => {\n                                                const date = new Date(a.audit_date);\n                                                return a.part_name?.trim() === prod.trim() && date.getMonth() === monthIdx;\n                                            });\n                                            return (\n                                                <td key={`${prod}-${m}-actual`} className=\"p-2 bg-white\">\n                                                    <div className=\"d-flex flex-wrap gap-1 justify-content-center\">\n                                                        {prodActuals.map(a => (\n                                                            <div key={a.audit_id} className=\"position-relative d-inline-block\">\n                                                                <Badge\n                                                                    pill\n                                                                    bg={a.status === 'Completed' ? 'success' : 'warning'}\n                                                                    className=\"cursor-pointer shadow-xs d-flex align-items-center gap-1\"\n                                                                    style={{ fontSize: '10px', padding: '5px 8px' }}\n                                                                    onClick={() => navigate(`/l1/audit/${a.audit_id}`)}\n                                                                >\n                                                                    {new Date(a.audit_date).getDate()}\n                                                                </Badge>\n                                                                {user?.role === 'Admin' && (\n                                                                    <>\n                                                                        <div\n                                                                            className=\"position-absolute bg-primary text-white rounded-circle d-flex align-items-center justify-content-center cursor-pointer shadow-sm hover-scale transition-all\"\n                                                                            style={{\n                                                                                top: '-6px',\n                                                                                right: '10px',\n                                                                                width: '16px',\n                                                                                height: '16px',\n                                                                                fontSize: '8px',\n                                                                                border: '1px solid white',\n                                                                                zIndex: 10\n                                                                            }}\n                                                                            onClick={(e) => {\n                                                                                e.stopPropagation();\n                                                                                setEditDateAudit(a);\n                                                                                setNewDate(new Date(a.audit_date).toISOString().split('T')[0]);\n                                                                            }}\n                                                                        >\n                                                                            <FaEdit />\n                                                                        </div>\n                                                                        <div\n                                                                            className=\"position-absolute bg-danger text-white rounded-circle d-flex align-items-center justify-content-center cursor-pointer shadow-sm hover-scale transition-all\"\n                                                                            style={{\n                                                                                top: '-6px',\n                                                                                right: '-6px',\n                                                                                width: '16px',\n                                                                                height: '16px',\n                                                                                fontSize: '8px',\n                                                                                border: '1px solid white',\n                                                                                zIndex: 10\n                                                                            }}\n                                                                            onClick={(e) => {\n                                                                                e.stopPropagation();\n                                                                                setDeleteAuditConfirm(a.audit_id);\n                                                                            }}\n                                                                        >\n                                                                            <FaTimes />\n                                                                        </div>\n                                                                    </>\n                                                                )}\n                                                            </div>\n                                                        ))}\n                                                        {/* Manual scheduling removed per user request */}\n                                                    </div>\n                                                </td>\n                                            );\n                                        })}\n                                    </tr>\n                                </React.Fragment>\n                            ))}\n                        </tbody>\n                    </Table>\n                </div>\n            </Card>\n\n            <Modal show={showAddModal} onHide={() => setShowAddModal(false)} centered className=\"fade\">\n                <Modal.Header closeButton className=\"border-0 pb-0\"><Modal.Title className=\"fw-bold\">Register Product Family</Modal.Title></Modal.Header>\n                <Modal.Body className=\"pt-3\">\n                    <Form.Group>\n                        <Form.Label className=\"small fw-bold text-muted text-uppercase mb-2\">Part Name / Family Identity</Form.Label>\n                        <Form.Control\n                            type=\"text\"\n                            placeholder=\"Serrated FY Series\"\n                            value={newProductName}\n                            onChange={(e) => setNewProductName(e.target.value)}\n                            className=\"py-2 px-3 border-2\"\n                            style={{ borderRadius: '10px' }}\n                        />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer className=\"border-0 pt-0\">\n                    <Button variant=\"light\" className=\"px-4 fw-bold text-muted\" onClick={() => setShowAddModal(false)}>Cancel</Button>\n                    <Button variant=\"primary\" className=\"px-4 fw-bold shadow-sm\" onClick={handleAddProduct}>Confirm Registry</Button>\n                </Modal.Footer>\n            </Modal>\n\n            <ConfirmationModal\n                show={!!deleteProductConfirm}\n                onClose={() => setDeleteProductConfirm(null)}\n                onConfirm={handleDeleteProduct}\n                title=\"Remove Strategic Asset\"\n                message={`Are you sure you want to unregister \"${deleteProductConfirm}\"? All historical plan data for this family will be discarded.`}\n                confirmText=\"Confirm Removal\"\n                variant=\"danger\"\n            />\n\n            <ConfirmationModal\n                show={!!deleteAuditConfirm}\n                onClose={() => setDeleteAuditConfirm(null)}\n                onConfirm={handleDeleteAudit}\n                title=\"Discard Historical Protocol\"\n                message=\"Are you sure you want to permanently delete this audit record? All associated checklist data and Non-Conformances will be lost.\"\n                confirmText=\"Permanently Delete\"\n                variant=\"danger\"\n            />\n\n            {/* Reschedule Modal */}\n            <Modal show={!!editDateAudit} onHide={() => setEditDateAudit(null)} centered>\n                <Modal.Header closeButton><Modal.Title>Reschedule Audit</Modal.Title></Modal.Header>\n                <Modal.Body>\n                    <Form.Group>\n                        <Form.Label className=\"small fw-bold\">New Date for {editDateAudit?.machine_name}</Form.Label>\n                        <Form.Control type=\"date\" value={newDate} onChange={(e) => setNewDate(e.target.value)} />\n                    </Form.Group>\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"light\" onClick={() => setEditDateAudit(null)}>Cancel</Button>\n                    <Button variant=\"primary\" onClick={handleUpdateDate}>Update Schedule</Button>\n                </Modal.Footer>\n            </Modal>\n\n            {/* Schedule Extra Audit Confirmation */}\n            <ConfirmationModal\n                show={!!scheduleConfirm}\n                onClose={() => setScheduleConfirm(null)}\n                onConfirm={handleSchedule}\n                title=\"Manual Audit Insertion\"\n                message={`Schedule an unscheduled Manufacturing Audit for ${scheduleConfirm?.product} in ${scheduleConfirm?.month}?`}\n                confirmText=\"Insert Audit\"\n                variant=\"primary\"\n            />\n\n            {/* SUMMARY TABLE */}\n            {(() => {\n                const summaryData = months.map((m) => {\n                    const monthIdx = months.indexOf(m);\n                    const actualForMonth = actuals.filter(a => {\n                        const date = new Date(a.audit_date);\n                        return date.getMonth() === monthIdx && date.getFullYear() === year && a.status === 'Completed';\n                    }).length;\n\n                    // Count unique planned weeks for this month across all products\n                    const plannedCount = products.reduce((acc, prod) => {\n                        const p = plans.find(entry => entry.part_family === prod && entry.month === m);\n                        let count = 0;\n                        if (p?.week_1_plan) count++;\n                        if (p?.week_2_plan) count++;\n                        if (p?.week_3_plan) count++;\n                        if (p?.week_4_plan) count++;\n                        return acc + count;\n                    }, 0);\n\n                    return { month: m, plan: plannedCount, actual: actualForMonth, nc: 0 };\n                });\n\n                const totalPlan = summaryData.reduce((acc, curr) => acc + curr.plan, 0);\n                const totalActual = summaryData.reduce((acc, curr) => acc + curr.actual, 0);\n\n                return (\n                    <Card className=\"mt-5 border-0 shadow-sm overflow-hidden rounded-4\" style={{ maxWidth: '650px' }}>\n                        <Card.Header className=\"bg-white py-3 border-bottom\">\n                            <h5 className=\"mb-0 fw-bold\">Manufacturing Audit Summary - {year}</h5>\n                        </Card.Header>\n                        <Table responsive hover className=\"mb-0 text-center align-middle\">\n                            <thead className=\"table-light\">\n                                <tr>\n                                    <th>Sr no</th>\n                                    <th>Months</th>\n                                    <th>Total Plan</th>\n                                    <th>Total Actual</th>\n                                    <th>No. Of NC</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {summaryData.map((s, i) => (\n                                    <tr key={s.month}>\n                                        <td>{i + 1}</td>\n                                        <td className=\"fw-bold\">{s.month}</td>\n                                        <td>{s.plan}</td>\n                                        <td>{s.actual}</td>\n                                        <td>{s.nc}</td>\n                                    </tr>\n                                ))}\n                                <tr className=\"table-primary border-top-2\">\n                                    <td colSpan={2} className=\"fw-bold text-end pe-4\">Total</td>\n                                    <td className=\"fw-bold\">{totalPlan}</td>\n                                    <td className=\"fw-bold\">{totalActual}</td>\n                                    <td className=\"fw-bold\">0</td>\n                                </tr>\n                            </tbody>\n                        </Table>\n                    </Card>\n                );\n            })()}\n        </Container>\n    );\n};\n\nexport default ManufacturingProductAuditPlan;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\NCHistory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\ScheduleAudit.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1901,1904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1901,1904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3609,3612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3609,3612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7277,7280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7277,7280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":134,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":137,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7322,7325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7322,7325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8543,8546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8543,8546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":367,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":367,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19705,19708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19705,19708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":379,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":379,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20580,20583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20580,20583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":392,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":392,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21421,21424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21421,21424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":413,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22651,22654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22651,22654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23782,23785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23782,23785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Container, Button, Form, Row, Col, Card, Modal, Table, Badge } from 'react-bootstrap';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport { toast } from 'react-toastify';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport PromptModal from '../../components/common/PromptModal';\n\nconst ScheduleAudit = () => {\n    const navigate = useNavigate();\n    const [templates, setTemplates] = useState<any[]>([]);\n    const [users, setUsers] = useState<any[]>([]);\n    const [dockProducts, setDockProducts] = useState<string[]>([]);\n    const [mfgProducts, setMfgProducts] = useState<string[]>([]);\n    const mfgProcesses = [\n        'Boring and Grooving', 'Lapping', 'Turning', 'Size Broaching', 'WP Pressing',\n        'Broaching', 'Hub OD Grinding', 'Serration', 'Spline Rolling', 'Glide Coating',\n        'Shaving', 'Back Face Grinding', 'UJ Profile Grinding', 'Face Grinding',\n        'Welding', 'Painting', 'Grobbing', 'PCD Drilling', 'Surface Broaching',\n        'Drilling and tapping', 'Nib milling', 'Hardning'\n    ];\n\n    // Scheduler State\n    const [selectedTemplateName, setSelectedTemplateName] = useState('');\n    const [scheduleData, setScheduleData] = useState({\n        template_id: '',\n        machine_name: '',\n        audit_date: '',\n        shift: 'A',\n        l1_auditor_id: '',\n        l2_auditor_id: '',\n        process_owner_id: '',\n        // Manufacturing fields\n        operation: '',\n        part_name: '',\n        part_number: '',\n        // Dock Audit fields\n        series: '',\n        invoice_no: '',\n        doc_no: '',\n        qty_audited: '',\n        process: ''\n    });\n\n    // Question editor state\n    const [showQuestionModal, setShowQuestionModal] = useState(false);\n    const [selectedTemplateQuestions, setSelectedTemplateQuestions] = useState<any[]>([]);\n\n    // Modal states\n    const [questionToDelete, setQuestionToDelete] = useState<string | null>(null);\n    const [sectionToAddQuestion, setSectionToAddQuestion] = useState<{ sectionId: string, order: number } | null>(null);\n\n    const fetchData = async () => {\n        try {\n            const [tempRes, userRes, dockProdRes, mfgProdRes] = await Promise.all([\n                api.get('/templates'),\n                api.get('/users'),\n                api.get('/dock-plan/products'),\n                api.get('/mfg-plan/products')\n            ]);\n            setTemplates(tempRes.data);\n            setUsers(userRes.data);\n            setDockProducts(dockProdRes.data);\n            setMfgProducts(mfgProdRes.data);\n\n            // Set default template\n            if (tempRes.data.length > 0) {\n                const firstTemplate = tempRes.data[0];\n                setScheduleData(prev => ({\n                    ...prev,\n                    template_id: firstTemplate.template_id,\n                    machine_name: firstTemplate.template_name === 'Dock Audit' ? 'DOCK-AREA' : ''\n                }));\n                setSelectedTemplateName(firstTemplate.template_name);\n            }\n        } catch {\n            toast.error(\"Failed to load templates or users.\");\n        }\n    };\n\n    useEffect(() => {\n        const load = async () => {\n            await fetchData();\n        };\n        load();\n    }, []);\n\n    const handleSchedule = async (e: React.FormEvent) => {\n        e.preventDefault();\n        try {\n            await api.post('/audits/schedule', scheduleData);\n            toast.success(\"Audit Scheduled Successfully!\");\n            navigate('/admin/dashboard');\n        } catch (err: any) {\n            toast.error(err.response?.data?.error || \"Scheduling failed\");\n        }\n    };\n\n    // Helper to filter users for dropdowns\n    // Include 'Admin' in all dropdowns because they have overlapping roles (L1, L2, Owner)\n    const getByRole = (role: string) => users.filter(u => u.role === role || u.role === 'Admin');\n\n    // Question Editing Logic\n    const handleViewQuestions = async () => {\n        if (!scheduleData.template_id) return toast.warning(\"Select a template first\");\n        try {\n            const res = await api.get(`/templates/${scheduleData.template_id}`);\n            setSelectedTemplateQuestions(res.data.sections || []);\n            setShowQuestionModal(true);\n        } catch {\n            toast.error(\"Failed to load questions\");\n        }\n    };\n\n    const handleUpdateQuestion = async (qId: string, text: string, type: string) => {\n        try {\n            await api.put(`/templates/questions/${qId}`, { question_text: text, input_type: type });\n            handleViewQuestions();\n        } catch {\n            toast.error(\"Failed to update question\");\n        }\n    };\n\n    const handleDeleteQuestion = async (qId: string) => {\n        try {\n            await api.delete(`/templates/questions/${qId}`);\n            handleViewQuestions();\n        } catch {\n            toast.error(\"Failed to delete question\");\n        }\n    };\n\n    const handleAddQuestion = async (secId: string, text: string, order: number) => {\n        try {\n            if (!scheduleData.template_id) return;\n            await api.post(`/templates/${scheduleData.template_id}/sections/${secId}/questions`, {\n                question_text: text,\n                question_order: order,\n                input_type: 'standard'\n            });\n            handleViewQuestions();\n        } catch {\n            toast.error(\"Failed to add question\");\n        }\n    };\n\n    return (\n        <Container className=\"py-4\">\n            <div className=\"mb-3\">\n                <Button variant=\"link\" className=\"text-decoration-none text-muted p-0\" onClick={() => navigate('/admin/dashboard')}>\n                    ‚Üê Back to Dashboard\n                </Button>\n            </div>\n            <div className=\"d-flex justify-content-between align-items-center mb-4\">\n                <div>\n                    <h2 className=\"fw-bold\">Schedule New Audit</h2>\n                    <p className=\"text-muted\">Create a new audit plan implementation.</p>\n                </div>\n            </div>\n\n            <Card className=\"shadow-sm border-0 p-3 p-md-4 mb-5\">\n                <Form onSubmit={handleSchedule}>\n                    {/* Section 1: Audit Configuration */}\n                    <div className=\"mb-4\">\n                        <h5 className=\"text-primary fw-bold mb-3 d-flex align-items-center\">\n                            <span className=\"bg-primary text-white rounded-circle me-2 d-inline-flex justify-content-center align-items-center\" style={{ width: '24px', height: '24px', fontSize: '14px' }}>1</span>\n                            Audit Configuration\n                        </h5>\n                        <hr className=\"mt-0 mb-3 opacity-25\" />\n                        <Row className=\"g-3\">\n                            <Col md={6}>\n                                <Form.Label className=\"small fw-bold\">Audit Template</Form.Label>\n                                <div className=\"d-flex gap-2\">\n                                    <Form.Select\n                                        value={scheduleData.template_id}\n                                        onChange={e => {\n                                            const selectedTemplate = templates.find((t: any) => t.template_id === e.target.value) as any;\n                                            setScheduleData({\n                                                ...scheduleData,\n                                                template_id: e.target.value,\n                                                machine_name: selectedTemplate?.template_name === 'Dock Audit' ? 'DOCK-AREA' : '',\n                                                operation: '',\n                                                part_name: '',\n                                                part_number: '',\n                                                series: '',\n                                                invoice_no: '',\n                                                doc_no: '',\n                                                qty_audited: '',\n                                                process: ''\n                                            });\n                                            setSelectedTemplateName(selectedTemplate?.template_name || '');\n                                        }}\n                                    >\n                                        <option value=\"\">Select Template...</option>\n                                        {templates.map((t: any) => <option key={t.template_id} value={t.template_id}>{t.template_name}</option>)}\n                                    </Form.Select>\n                                    <Button variant=\"info\" size=\"sm\" className=\"px-3 fw-bold shadow-sm\" onClick={handleViewQuestions}>View Checklist</Button>\n                                </div>\n                                <Form.Text className=\"text-muted small\">\n                                    Manage templates in <Button variant=\"link\" className=\"p-0 small align-baseline text-decoration-none\" onClick={() => navigate('/admin/templates')}>Template Management</Button>\n                                </Form.Text>\n                            </Col>\n                            {selectedTemplateName !== 'Dock Audit' && (\n                                <Col md={6}>\n                                    <Form.Label className=\"small fw-bold\">Machine Name / Line</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"EY-LINE-1\"\n                                        value={scheduleData.machine_name}\n                                        onChange={e => setScheduleData({ ...scheduleData, machine_name: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                            )}\n                            <Col md={6}>\n                                <Form.Label className=\"small fw-bold\">Scheduled Date</Form.Label>\n                                <Form.Control\n                                    type=\"date\"\n                                    min={new Date().toISOString().split('T')[0]}\n                                    value={scheduleData.audit_date}\n                                    onChange={e => setScheduleData({ ...scheduleData, audit_date: e.target.value })}\n                                    required\n                                />\n                            </Col>\n                            <Col md={6}>\n                                <Form.Label className=\"small fw-bold\">Shift</Form.Label>\n                                <Form.Select\n                                    value={scheduleData.shift}\n                                    onChange={e => setScheduleData({ ...scheduleData, shift: e.target.value })}\n                                >\n                                    <option value=\"A\">Shift A</option>\n                                    <option value=\"B\">Shift B</option>\n                                    <option value=\"C\">Shift C</option>\n                                </Form.Select>\n                            </Col>\n                        </Row>\n                    </div>\n\n                    {/* Section 2: Product & Process Details */}\n                    <div className=\"mb-4 bg-light p-3 rounded shadow-sm border\">\n                        <h5 className=\"text-secondary fw-bold mb-3 d-flex align-items-center\">\n                            <span className=\"bg-secondary text-white rounded-circle me-2 d-inline-flex justify-content-center align-items-center\" style={{ width: '22px', height: '22px', fontSize: '12px' }}>2</span>\n                            Product & Process Details\n                        </h5>\n                        <hr className=\"mt-0 mb-3 opacity-25\" />\n\n                        {selectedTemplateName === 'Dock Audit' ? (\n                            <Row className=\"g-3\">\n                                <Col md={6}>\n                                    <Form.Label className=\"small fw-bold\">Part Name (Product)</Form.Label>\n                                    <Form.Select\n                                        value={scheduleData.part_name}\n                                        onChange={e => setScheduleData({ ...scheduleData, part_name: e.target.value })}\n                                        required\n                                    >\n                                        <option value=\"\">Select Product...</option>\n                                        {dockProducts.map(p => <option key={p} value={p}>{p}</option>)}\n                                    </Form.Select>\n                                </Col>\n                                <Col md={6}>\n                                    <Form.Label className=\"small fw-bold\">Part Number</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"PN-12345\"\n                                        value={scheduleData.part_number}\n                                        onChange={e => setScheduleData({ ...scheduleData, part_number: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={3}>\n                                    <Form.Label className=\"small fw-bold\">Series</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"Rev-00\"\n                                        value={scheduleData.series}\n                                        onChange={e => setScheduleData({ ...scheduleData, series: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={3}>\n                                    <Form.Label className=\"small fw-bold\">Invoice No.</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"QF/QA/134\"\n                                        value={scheduleData.invoice_no}\n                                        onChange={e => setScheduleData({ ...scheduleData, invoice_no: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={3}>\n                                    <Form.Label className=\"small fw-bold\">Doc No.</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"Dated: 27-07-2024\"\n                                        value={scheduleData.doc_no}\n                                        onChange={e => setScheduleData({ ...scheduleData, doc_no: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={3}>\n                                    <Form.Label className=\"small fw-bold\">Qty. Audited</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"100\"\n                                        value={scheduleData.qty_audited}\n                                        onChange={e => setScheduleData({ ...scheduleData, qty_audited: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                            </Row>\n                        ) : (\n                            <Row className=\"g-3\">\n                                <Col md={4}>\n                                    <Form.Label className=\"small fw-bold\">Part Name (Product)</Form.Label>\n                                    <Form.Select\n                                        value={scheduleData.part_name}\n                                        onChange={e => setScheduleData({ ...scheduleData, part_name: e.target.value })}\n                                        required\n                                    >\n                                        <option value=\"\">Select Product...</option>\n                                        {mfgProducts.map(p => <option key={p} value={p}>{p}</option>)}\n                                    </Form.Select>\n                                </Col>\n                                <Col md={4}>\n                                    <Form.Label className=\"small fw-bold\">Operation</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"Assembly\"\n                                        value={scheduleData.operation}\n                                        onChange={e => setScheduleData({ ...scheduleData, operation: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={4}>\n                                    <Form.Label className=\"small fw-bold\">Part Number</Form.Label>\n                                    <Form.Control\n                                        placeholder=\"PN-12345\"\n                                        value={scheduleData.part_number}\n                                        onChange={e => setScheduleData({ ...scheduleData, part_number: e.target.value })}\n                                        required\n                                    />\n                                </Col>\n                                <Col md={4}>\n                                    <Form.Label className=\"small fw-bold\">Manufacturing Process</Form.Label>\n                                    <Form.Select\n                                        value={scheduleData.process}\n                                        onChange={e => setScheduleData({ ...scheduleData, process: e.target.value })}\n                                        required\n                                    >\n                                        <option value=\"\">Select Process...</option>\n                                        {mfgProcesses.map(p => <option key={p} value={p}>{p}</option>)}\n                                    </Form.Select>\n                                </Col>\n                            </Row>\n                        )}\n                    </div>\n\n                    {/* Section 3: Personnel Assignment */}\n                    <div className=\"mb-4\">\n                        <h5 className=\"text-success fw-bold mb-3 d-flex align-items-center\">\n                            <span className=\"bg-success text-white rounded-circle me-2 d-inline-flex justify-content-center align-items-center\" style={{ width: '22px', height: '22px', fontSize: '12px' }}>3</span>\n                            Personnel Assignment\n                        </h5>\n                        <hr className=\"mt-0 mb-3 opacity-25\" />\n                        <Row className=\"g-3\">\n                            <Col md={4}>\n                                <Form.Label className=\"small fw-bold\">Assign L1 (Inspector)</Form.Label>\n                                <Form.Select\n                                    required\n                                    value={scheduleData.l1_auditor_id}\n                                    onChange={e => setScheduleData({ ...scheduleData, l1_auditor_id: e.target.value })}\n                                >\n                                    <option value=\"\">Select L1...</option>\n                                    {getByRole('L1_Auditor').map((u: any) => <option key={u.user_id} value={u.user_id}>{u.full_name}</option>)}\n                                </Form.Select>\n                            </Col>\n                            <Col md={4}>\n                                <Form.Label className=\"small fw-bold\">Assign Process Owner</Form.Label>\n                                <Form.Select\n                                    required\n                                    value={scheduleData.process_owner_id}\n                                    onChange={e => setScheduleData({ ...scheduleData, process_owner_id: e.target.value })}\n                                >\n                                    <option value=\"\">Select Owner...</option>\n                                    {/* Strictly show only Process Owners here */}\n                                    {users.filter(u => u.role === 'Process_Owner').map((u: any) => (\n                                        <option key={u.user_id} value={u.user_id}>{u.full_name}</option>\n                                    ))}\n                                </Form.Select>\n                            </Col>\n                            <Col md={4}>\n                                <Form.Label className=\"small fw-bold\">Assign L2 (Approver)</Form.Label>\n                                <Form.Select\n                                    required\n                                    value={scheduleData.l2_auditor_id}\n                                    onChange={e => setScheduleData({ ...scheduleData, l2_auditor_id: e.target.value })}\n                                >\n                                    <option value=\"\">Select L2...</option>\n                                    {getByRole('L2_Auditor').map((u: any) => <option key={u.user_id} value={u.user_id}>{u.full_name}</option>)}\n                                </Form.Select>\n                            </Col>\n                        </Row>\n                    </div>\n\n                    <div className=\"mt-4 d-flex flex-column flex-sm-row justify-content-end align-items-center gap-3 border-top pt-4\">\n                        <Button variant=\"light\" className=\"px-4 border fw-medium\" onClick={() => navigate('/admin/dashboard')}>Cancel</Button>\n                        <Button type=\"submit\" variant=\"primary\" className=\"px-5 fw-bold shadow-sm\">Confirm & Schedule</Button>\n                    </div>\n                </Form>\n            </Card>\n\n            {/* Question Editor Modal */}\n            <Modal show={showQuestionModal} onHide={() => setShowQuestionModal(false)} size=\"xl\">\n                <Modal.Header closeButton><Modal.Title>Edit Template Questions</Modal.Title></Modal.Header>\n                <Modal.Body>\n                    {selectedTemplateQuestions.length === 0 && (\n                        <div className=\"text-muted p-3\">No sections loaded. Please select a template first.</div>\n                    )}\n\n                    {selectedTemplateQuestions.map((sec: any) => (\n                        <Card key={sec.section_id} className=\"mb-4 shadow-sm border-0\">\n                            <Card.Header className=\"bg-light fw-bold d-flex justify-content-between align-items-center\">\n                                <span>{sec.section_name}</span>\n                                <Badge bg=\"secondary\">{sec.questions?.length || 0} Questions</Badge>\n                            </Card.Header>\n                            <Card.Body className=\"p-0\">\n                                <Table striped hover responsive className=\"mb-0 align-middle\">\n                                    <thead>\n                                        <tr>\n                                            <th style={{ width: '5%' }}>#</th>\n                                            <th>Question Text</th>\n                                            <th style={{ width: '100px' }} className=\"text-center\">Actions</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        {(sec.questions || []).map((q: any, idx: number) => (\n                                            <tr key={q.question_id}>\n                                                <td className=\"text-center text-muted\">{idx + 1}</td>\n                                                <td>\n                                                    <Form.Control\n                                                        defaultValue={q.question_text}\n                                                        onBlur={(e) => {\n                                                            if (e.target.value !== q.question_text) {\n                                                                handleUpdateQuestion(q.question_id, e.target.value, q.input_type || 'standard');\n                                                            }\n                                                        }}\n                                                    />\n                                                </td>\n\n                                                <td className=\"text-center\">\n                                                    <Button\n                                                        size=\"sm\"\n                                                        variant=\"outline-danger\"\n                                                        onClick={() => setQuestionToDelete(q.question_id)}\n                                                    >\n                                                        Remove\n                                                    </Button>\n                                                </td>\n                                            </tr>\n                                        ))}\n                                        {sec.questions && sec.questions.length === 0 && (\n                                            <tr><td colSpan={4} className=\"text-center text-muted py-3\">No questions in this section yet.</td></tr>\n                                        )}\n                                    </tbody>\n                                </Table>\n                            </Card.Body>\n                            <Card.Footer className=\"bg-white border-top-0\">\n                                <Button\n                                    size=\"sm\"\n                                    variant=\"outline-primary\"\n                                    onClick={() => setSectionToAddQuestion({\n                                        sectionId: sec.section_id,\n                                        order: (sec.questions?.length || 0) + 1\n                                    })}\n                                >\n                                    + Add Question\n                                </Button>\n                            </Card.Footer>\n                        </Card>\n                    ))}\n                </Modal.Body>\n                <Modal.Footer>\n                    <Button variant=\"secondary\" onClick={() => setShowQuestionModal(false)}>Close</Button>\n                </Modal.Footer>\n            </Modal>\n\n            {/* Confirmation Modal */}\n            <ConfirmationModal\n                show={!!questionToDelete}\n                onClose={() => setQuestionToDelete(null)}\n                onConfirm={() => {\n                    if (questionToDelete) handleDeleteQuestion(questionToDelete);\n                    setQuestionToDelete(null);\n                }}\n                title=\"Delete Question\"\n                message=\"Are you sure you want to delete this question?\"\n                confirmText=\"Delete\"\n                variant=\"danger\"\n            />\n\n            {/* Prompt Modal */}\n            <PromptModal\n                show={!!sectionToAddQuestion}\n                onClose={() => setSectionToAddQuestion(null)}\n                onSubmit={(text) => {\n                    if (sectionToAddQuestion) {\n                        handleAddQuestion(sectionToAddQuestion.sectionId, text, sectionToAddQuestion.order);\n                    }\n                }}\n                title=\"Add New Question\"\n                label=\"Question Text\"\n                confirmText=\"Add Question\"\n            />\n        </Container>\n    );\n};\n\nexport default ScheduleAudit;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\TemplateManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[539,542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[539,542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2125,2128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2125,2128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Container, Button, Form, Row, Col, Card, Table, Alert, Spinner, Badge } from 'react-bootstrap';\nimport { useNavigate } from 'react-router-dom';\nimport { FaUpload, FaTrash, FaCheck, FaFileCsv } from 'react-icons/fa';\nimport api from '../../api/axios';\nimport { toast } from 'react-toastify';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\n\nconst TemplateManagement = () => {\n    const navigate = useNavigate();\n    const [templates, setTemplates] = useState<any[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [uploading, setUploading] = useState(false);\n    const [selectedFile, setSelectedFile] = useState<File | null>(null);\n    const [templateToDelete, setTemplateToDelete] = useState<string | null>(null);\n\n    useEffect(() => {\n        fetchTemplates();\n    }, []);\n\n    const fetchTemplates = async () => {\n        try {\n            setLoading(true);\n            const res = await api.get('/templates');\n            setTemplates(res.data);\n        } catch (err) {\n            console.error(err);\n            toast.error(\"Failed to load templates\");\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        if (e.target.files && e.target.files[0]) {\n            setSelectedFile(e.target.files[0]);\n        }\n    };\n\n    const handleUpload = async () => {\n        if (!selectedFile) return;\n\n        const formData = new FormData();\n        formData.append('file', selectedFile);\n\n        try {\n            setUploading(true);\n            const res = await api.post('/templates/import-csv', formData, {\n                headers: { 'Content-Type': 'multipart/form-data' }\n            });\n            toast.success(res.data.message || \"Template imported successfully\");\n            setSelectedFile(null);\n            // Reset file input\n            const fileInput = document.getElementById('csv-upload') as HTMLInputElement;\n            if (fileInput) fileInput.value = '';\n            fetchTemplates();\n        } catch (err: any) {\n            console.error(err);\n            toast.error(err.response?.data?.error || \"Import failed. Ensure CSV columns are correct: 'Template Name', 'Section Name', 'Question Text', 'Input Type'\");\n        } finally {\n            setUploading(false);\n        }\n    };\n\n    const handleDeleteTemplate = async () => {\n        if (!templateToDelete) return;\n        try {\n            await api.delete(`/templates/${templateToDelete}`);\n            toast.success(\"Template deleted successfully\");\n            fetchTemplates();\n        } catch (err) {\n            console.error(err);\n            toast.error(\"Failed to delete template. Ensure no audits are using it.\");\n        } finally {\n            setTemplateToDelete(null);\n        }\n    };\n\n    return (\n        <Container fluid className=\"py-4\">\n            <div className=\"mb-4\">\n                <Button variant=\"link\" className=\"text-decoration-none text-muted p-0 mb-3\" onClick={() => navigate('/admin/dashboard')}>\n                    ‚Üê Back to Dashboard\n                </Button>\n                <h2 className=\"fw-bold\">Audit Template Management</h2>\n                <p className=\"text-muted\">Upload and manage audit checksheets via CSV structure.</p>\n            </div>\n\n            <Row>\n                <Col lg={4}>\n                    <Card className=\"shadow-sm border-0 mb-4\">\n                        <Card.Header className=\"bg-white py-3\">\n                            <h5 className=\"mb-0 fw-bold d-flex align-items-center gap-2\">\n                                <FaUpload className=\"text-primary\" /> Import Template (CSV)\n                            </h5>\n                        </Card.Header>\n                        <Card.Body>\n                            <Alert variant=\"info\" className=\"small border-0 shadow-none\">\n                                <p className=\"mb-1\"><strong>Required CSV Columns:</strong></p>\n                                <ul className=\"mb-0 ps-3\">\n                                    <li>Template Name</li>\n                                    <li>Section Name</li>\n                                    <li>Question Text</li>\n                                    <li>Input Type (standard, calibration_row, shift_reading)</li>\n                                </ul>\n                            </Alert>\n\n                            <Form.Group className=\"mb-3\">\n                                <Form.Label className=\"small fw-bold\">Select CSV File</Form.Label>\n                                <div className=\"d-flex gap-2\">\n                                    <Form.Control\n                                        type=\"file\"\n                                        id=\"csv-upload\"\n                                        accept=\".csv\"\n                                        onChange={handleFileChange}\n                                        className=\"form-control-sm\"\n                                    />\n                                </div>\n                            </Form.Group>\n\n                            <Button\n                                variant=\"primary\"\n                                className=\"w-100 fw-bold d-flex align-items-center justify-content-center gap-2 py-2\"\n                                disabled={!selectedFile || uploading}\n                                onClick={handleUpload}\n                            >\n                                {uploading ? <Spinner size=\"sm\" /> : <FaCheck />}\n                                {uploading ? 'Processing...' : 'Upload & Analyze Template'}\n                            </Button>\n                        </Card.Body>\n                    </Card>\n\n                    <Card className=\"shadow-sm border-0 bg-light\">\n                        <Card.Body className=\"p-4 text-center\">\n                            <FaFileCsv size={40} className=\"text-muted mb-3\" />\n                            <h6 className=\"fw-bold mb-2\">Instructions</h6>\n                            <p className=\"small text-muted mb-0\">\n                                This automated system will analyze your CSV, create sections, and map questions to the database. Use 'standard' for normal OK/NC/Obs/NA questions.\n                            </p>\n                        </Card.Body>\n                    </Card>\n                </Col>\n\n                <Col lg={8}>\n                    <Card className=\"shadow-sm border-0\">\n                        <Card.Header className=\"bg-white py-3 d-flex justify-content-between align-items-center\">\n                            <h5 className=\"mb-0 fw-bold\">Active Templates</h5>\n                            <Badge bg=\"primary\">{templates.length}</Badge>\n                        </Card.Header>\n                        <Card.Body className=\"p-0\">\n                            {loading ? (\n                                <div className=\"text-center py-5\">\n                                    <Spinner animation=\"border\" variant=\"primary\" />\n                                </div>\n                            ) : templates.length === 0 ? (\n                                <div className=\"text-center py-5 text-muted\">\n                                    No templates found. Upload your first one!\n                                </div>\n                            ) : (\n                                <Table hover responsive className=\"mb-0 align-middle\">\n                                    <thead className=\"table-light\">\n                                        <tr>\n                                            <th>Template Name</th>\n                                            <th>Description</th>\n                                            <th>Created At</th>\n                                            <th className=\"text-center\">Action</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        {templates.map(t => (\n                                            <tr key={t.template_id}>\n                                                <td className=\"fw-bold\">{t.template_name}</td>\n                                                <td className=\"small text-muted\">{t.description || 'No description'}</td>\n                                                <td className=\"small\">{new Date(t.created_at).toLocaleDateString()}</td>\n                                                <td className=\"text-center\">\n                                                    <div className=\"d-flex justify-content-center gap-2\">\n                                                        <Button variant=\"outline-primary\" size=\"sm\" onClick={() => navigate(`/admin/schedule?template=${t.template_id}`)}>\n                                                            Use\n                                                        </Button>\n                                                        <Button variant=\"outline-danger\" size=\"sm\" onClick={() => setTemplateToDelete(t.template_id)}>\n                                                            <FaTrash />\n                                                        </Button>\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </Table>\n                            )}\n                        </Card.Body>\n                    </Card>\n                </Col>\n            </Row>\n\n            <ConfirmationModal\n                show={!!templateToDelete}\n                onClose={() => setTemplateToDelete(null)}\n                onConfirm={handleDeleteTemplate}\n                title=\"Delete Template\"\n                message=\"Are you sure you want to delete this template? This cannot be undone.\"\n                confirmText=\"Delete\"\n                variant=\"danger\"\n            />\n        </Container>\n    );\n};\n\nexport default TemplateManagement;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\admin\\UserManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407,410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407,410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1401,1404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1401,1404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2905,2908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2905,2908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { Container, Table, Button, Modal, Form, Badge, Spinner } from 'react-bootstrap';\nimport { FaTrash, FaUserPlus } from 'react-icons/fa';\nimport api from '../../api/axios';\nimport { toast } from 'react-toastify';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\n\nconst UserManagement = () => {\n  const [users, setUsers] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showModal, setShowModal] = useState(false);\n  const [userToDelete, setUserToDelete] = useState<string | null>(null);\n\n  // New User Form State\n  const [formData, setFormData] = useState({\n    full_name: '',\n    email: '',\n    password: '',\n    role: 'L1_Auditor' // Default\n  });\n\n  useEffect(() => {\n    fetchUsers();\n  }, []);\n\n  const fetchUsers = async () => {\n    try {\n      const res = await api.get('/users');\n      setUsers(res.data);\n    } catch {\n      toast.error(\"Failed to load users\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateUser = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      await api.post('/users', formData);\n      toast.success(\"User Created Successfully!\");\n      setShowModal(false);\n      setFormData({ full_name: '', email: '', password: '', role: 'L1_Auditor' }); // Reset\n      fetchUsers();\n    } catch (err) {\n      toast.error((err as any).response?.data?.error || \"Failed to create user\");\n    }\n  };\n\n  const handleDeleteUser = async (userId: string) => {\n    try {\n      await api.delete(`/users/${userId}`);\n      toast.success(\"User deleted successfully\");\n      fetchUsers();\n    } catch {\n      toast.error(\"Failed to delete user\");\n    }\n  };\n\n  const getRoleBadge = (role: string) => {\n    switch (role) {\n      case 'Admin': return <Badge bg=\"dark\">Admin</Badge>;\n      case 'L1_Auditor': return <Badge bg=\"primary\">L1 Auditor</Badge>;\n      case 'L2_Auditor': return <Badge bg=\"warning\" text=\"dark\">L2 Auditor</Badge>;\n      case 'Process_Owner': return <Badge bg=\"info\">Process Owner</Badge>;\n      default: return <Badge bg=\"secondary\">{role}</Badge>;\n    }\n  };\n\n  if (loading) return <div className=\"text-center mt-5\"><Spinner animation=\"border\" /></div>;\n\n  return (\n    <Container className=\"py-4\">\n      <div className=\"d-flex justify-content-between align-items-center mb-4\">\n        <h3 className=\"fw-bold m-0\">User Management</h3>\n        <Button variant=\"primary\" className=\"shadow-sm px-4\" onClick={() => setShowModal(true)}>\n          <FaUserPlus className=\"me-2\" /> Add New User\n        </Button>\n      </div>\n\n      <Table hover responsive className=\"align-middle shadow-sm\">\n        <thead className=\"table-light\">\n          <tr>\n            <th>Name</th>\n            <th>Email</th>\n            <th>Role</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {users.map((u: any) => (\n            <tr key={u.user_id}>\n              <td className=\"fw-bold\">{u.full_name}</td>\n              <td>{u.email}</td>\n              <td>{getRoleBadge(u.role)}</td>\n              <td>\n                {u.role !== 'Admin' && (\n                  <Button variant=\"outline-danger\" size=\"sm\" onClick={() => setUserToDelete(u.user_id)}>\n                    <FaTrash />\n                  </Button>\n                )}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n\n      {/* Create User Modal */}\n      <Modal show={showModal} onHide={() => setShowModal(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>Add System User</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Form onSubmit={handleCreateUser}>\n            <Form.Group className=\"mb-3\">\n              <Form.Label>Full Name</Form.Label>\n              <Form.Control\n                required\n                value={formData.full_name}\n                onChange={e => setFormData({ ...formData, full_name: e.target.value })}\n              />\n            </Form.Group>\n            <Form.Group className=\"mb-3\">\n              <Form.Label>Email</Form.Label>\n              <Form.Control\n                type=\"email\"\n                required\n                value={formData.email}\n                onChange={e => setFormData({ ...formData, email: e.target.value })}\n              />\n            </Form.Group>\n            <Form.Group className=\"mb-3\">\n              <Form.Label>Password</Form.Label>\n              <Form.Control\n                type=\"password\"\n                required\n                value={formData.password}\n                onChange={e => setFormData({ ...formData, password: e.target.value })}\n              />\n            </Form.Group>\n            <Form.Group className=\"mb-3\">\n              <Form.Label>Role</Form.Label>\n              <Form.Select\n                value={formData.role}\n                onChange={e => setFormData({ ...formData, role: e.target.value })}\n              >\n                <option value=\"L1_Auditor\">L1 Auditor (Inspector)</option>\n                <option value=\"L2_Auditor\">L2 Auditor (Approver)</option>\n                <option value=\"Process_Owner\">Process Owner (Fixer)</option>\n                <option value=\"Admin\">Administrator</option>\n              </Form.Select>\n            </Form.Group>\n            <div className=\"d-flex justify-content-end gap-2\">\n              <Button variant=\"secondary\" onClick={() => setShowModal(false)}>Cancel</Button>\n              <Button type=\"submit\" variant=\"primary\">Create User</Button>\n            </div>\n          </Form>\n        </Modal.Body>\n      </Modal>\n\n      <ConfirmationModal\n        show={!!userToDelete}\n        onClose={() => setUserToDelete(null)}\n        onConfirm={() => {\n          if (userToDelete) handleDeleteUser(userToDelete);\n          setUserToDelete(null);\n        }}\n        title=\"Delete User\"\n        message=\"Are you sure? This user will be permanently deleted.\"\n        confirmText=\"Delete\"\n        variant=\"danger\"\n      />\n    </Container>\n  );\n};\n\nexport default UserManagement;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\auth\\Login.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1148,1151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1148,1151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../hooks/useAuth';\nimport api from '../../api/axios';\nimport { Container, Card, Form, Button, Alert, Spinner } from 'react-bootstrap';\n\n\nconst Login = () => {\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const { login } = useAuth();\n  const navigate = useNavigate();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    try {\n      const res = await api.post('/auth/login', { email, password });\n      login(res.data.token, res.data.user);\n\n      // Redirect based on role\n      switch (res.data.user.role) {\n        case 'Admin': navigate('/admin/dashboard'); break;\n        case 'L1_Auditor': navigate('/l1/tasks'); break;\n        case 'L2_Auditor': navigate('/l2/inbox'); break;\n        case 'Process_Owner': navigate('/owner/tasks'); break;\n        default: navigate('/');\n      }\n    } catch (err) {\n      setError((err as any).response?.data?.error || 'Login failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"d-flex align-items-center justify-content-center min-vh-100\" style={{ backgroundColor: '#f8fafc' }}>\n      <Container style={{ maxWidth: '400px' }}>\n        <Card className=\"shadow-lg border-0 rounded-3 overflow-hidden\">\n          <div style={{ height: '4px', backgroundColor: '#2563eb' }}></div>\n          <Card.Body className=\"p-4 p-md-5\">\n            <div className=\"text-center mb-4\">\n              <img src=\"/DANA_logo.png\" alt=\"DANA Logo\" className=\"mb-2\" style={{ height: '60px' }} />\n              <div className=\"mb-3\">\n                <img src=\"/PeopleFindingABetterWay.png\" alt=\"People Finding A Better Way\" style={{ height: '25px' }} />\n              </div>\n              <h2 className=\"fw-bold text-dark mb-1\">Audit Portal</h2>\n              <p className=\"text-muted small\">Please sign in to your corporate account</p>\n            </div>\n\n            {error && (\n              <Alert variant=\"danger\" className=\"py-2 text-center small\">\n                {error}\n              </Alert>\n            )}\n\n            <Form onSubmit={handleSubmit}>\n              <Form.Group className=\"mb-3\">\n                <Form.Label className=\"small fw-bold\">Email Address</Form.Label>\n                <Form.Control\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"name@dana.com\"\n                  required\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-4\">\n                <Form.Label className=\"small fw-bold\">Password</Form.Label>\n                <Form.Control\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"Enter password\"\n                  required\n                />\n              </Form.Group>\n\n              <Button\n                variant=\"primary\"\n                type=\"submit\"\n                className=\"w-100 py-2 fw-bold\"\n                disabled={loading}\n                style={{ backgroundColor: '#2563eb', border: 'none' }}\n              >\n                {loading ? <Spinner size=\"sm\" animation=\"border\" /> : 'Sign In'}\n              </Button>\n            </Form>\n          </Card.Body>\n        </Card>\n        <div className=\"mt-4 text-center text-muted small\">\n          &copy; {new Date().getFullYear()} DANA Digital Auditing System\n        </div>\n      </Container>\n    </div>\n  );\n};\n\nexport default Login;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\auth\\Unauthorized.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\l1\\AuditWorkspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1159,1162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1159,1162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1592,1595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1592,1595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2077,2080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2077,2080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2347,2350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2347,2350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2647,2650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2647,2650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport { useAuth } from '../../hooks/useAuth'; // Import Auth\nimport { Container, Card, Nav, Button, Modal, Form, Badge, Alert } from 'react-bootstrap';\nimport { toast } from 'react-toastify';\nimport { FaTimes, FaCheckDouble } from 'react-icons/fa';\nimport ChecklistTab from '../../components/audit/tabs/ChecklistTab';\nimport ObjectivesTab from '../../components/audit/tabs/ObjectivesTab';\nimport CalibrationTab from '../../components/audit/tabs/CalibrationTab';\nimport ParametersTab from '../../components/audit/tabs/ParametersTab';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport Skeleton from '../../components/common/Skeleton';\n\nconst AuditWorkspace = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { user } = useAuth(); // Get current user\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [activeTab, setActiveTab] = useState('checklist');\n  const [auditData, setAuditData] = useState<any>(null);\n\n  // L2 Rejection State\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [rejectReason, setRejectReason] = useState('');\n\n  // Confirmation State\n  const [confirmAction, setConfirmAction] = useState<'submit' | 'approve' | null>(null);\n\n  const fetchAudit = useCallback(async () => {\n    try {\n      const res = await api.get(`/audits/${id}/full`);\n      setAuditData(res.data);\n    } catch (err: any) {\n      const errorMsg = err.response?.data?.error || err.message || 'Failed to load audit.';\n      setError(errorMsg);\n      setLoading(false);\n    } finally {\n      setLoading(false);\n    }\n  }, [id]);\n\n  useEffect(() => { fetchAudit(); }, [fetchAudit]);\n\n  // --- ACTIONS ---\n\n  const handleSubmitToL2 = async () => {\n    try {\n      await api.post(`/audits/${id}/submit-l2`);\n      toast.success(\"Submitted to L2 successfully\");\n      navigate('/l1/tasks');\n    } catch (err: any) { toast.error(err.response?.data?.error || \"Submission failed\"); }\n  };\n\n  const handleL2Approve = async () => {\n    try {\n      await api.put(`/audits/${id}/approve`);\n      toast.success(\"Audit Approved & Closed!\");\n      navigate('/l2/inbox');\n    } catch (err: any) { toast.error(err.response?.data?.error || \"Approval failed\"); }\n  };\n\n  const handleL2Reject = async () => {\n    try {\n      await api.put(`/audits/${id}/reject`, { reason: rejectReason });\n      toast.success(\"Audit Rejected. Sent back to L1.\");\n      navigate('/l2/inbox');\n    } catch (err: any) { toast.error(err.response?.data?.error || \"Rejection failed\"); }\n  };\n\n\n\n  if (loading) {\n    return (\n      <Container fluid className=\"py-4 fade-in\">\n        <Skeleton height={150} borderRadius=\"1rem\" className=\"mb-4\" />\n        <Card className=\"border-0 shadow-sm rounded-4\">\n          <Card.Header className=\"bg-white py-3 border-bottom d-flex gap-3\">\n            <Skeleton width={100} height={20} />\n            <Skeleton width={100} height={20} />\n          </Card.Header>\n          <Card.Body>\n            {[1, 2, 3, 4, 5].map(i => (\n              <div key={i} className=\"mb-3 d-flex gap-3 align-items-center\">\n                <Skeleton width={30} height={30} borderRadius=\"50%\" />\n                <Skeleton height={20} />\n              </div>\n            ))}\n          </Card.Body>\n        </Card>\n      </Container>\n    );\n  }\n\n  if (error) {\n    return (\n      <Container className=\"py-5 text-center fade-in\">\n        <div className=\"bg-danger bg-opacity-10 text-danger p-4 rounded-4 d-inline-block mb-4\">\n          <h3 className=\"fw-bold mb-1\">System Obstruction</h3>\n          <p className=\"mb-0 opacity-75\">{error}</p>\n        </div>\n        <br />\n        <Button variant=\"white\" className=\"border shadow-sm px-4\" onClick={() => navigate(-1)}>\n          Return to Command Center\n        </Button>\n      </Container>\n    );\n  }\n\n  // --- PERMISSIONS LOGIC ---\n  const isL1 = user?.role === 'L1_Auditor' || user?.role === 'Admin';\n  const isL2 = user?.role === 'L2_Auditor' || user?.role === 'Admin';\n\n  // L1 can edit if status is Assigned, NC_Open, or Rejected\n  // L2 can edit SCORES only if Submitted_to_L2\n  const isReadOnly = !(isL1 && ['Assigned', 'NC_Open', 'Rejected'].includes(auditData.audit.status));\n  const isScoringMode = isL2 && auditData.audit.status === 'Submitted_to_L2';\n\n  return (\n    <Container fluid className=\"py-4 fade-in\">\n      <div className=\"d-flex flex-column flex-lg-row justify-content-between align-items-stretch gap-3 mb-4\">\n        <div className=\"flex-grow-1\">\n          {auditData.audit.template_name === 'Dock Audit' ? (\n            /* --- DOCK AUDIT HEADER (Premium Format) --- */\n            <Card className=\"border-0 shadow-sm glass-panel overflow-hidden hover-lift transition-all\">\n              <div style={{ height: '4px', background: 'linear-gradient(90deg, #6366f1, #10b981)' }}></div>\n              <Card.Body className=\"p-0\">\n                <div className=\"px-4 py-3 border-bottom d-flex align-items-center justify-content-between bg-white bg-opacity-50\">\n                  <h4 className=\"fw-bold m-0 text-gradient-indigo text-uppercase tracking-wider\">Product Integrity Protocol</h4>\n                  <Badge pill bg=\"indigo-light\" className=\"px-3 py-2 text-indigo border border-indigo-subtle\" style={{ backgroundColor: 'rgba(99, 102, 241, 0.1)', color: '#6366f1' }}>\n                    PROTOCOL REF: {auditData.audit.audit_id}\n                  </Badge>\n                </div>\n                <div className=\"row g-0\">\n                  <div className=\"col-md-4 border-end border-light\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Product Nomenclature</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.part_name || '-'}</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Product Serial/Batch</small>\n                      <span className=\"fw-bold text-dark text-uppercase\">{auditData.audit.part_number || '-'}</span>\n                    </div>\n                  </div>\n                  <div className=\"col-md-4 border-end border-light\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Verification Timeline</small>\n                      <span className=\"fw-bold text-dark\">{new Date(auditData.audit.audit_date).toLocaleDateString(undefined, { dateStyle: 'long' })}</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Production Series</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.series || '-'} / Shift: {auditData.audit.shift}</span>\n                    </div>\n                  </div>\n                  <div className=\"col-md-4\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Inspection Vol.</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.qty_audited || '-'} Units Audited</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Authorized Auditor</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.l1_auditor_name}</span>\n                    </div>\n                  </div>\n                </div>\n              </Card.Body>\n            </Card>\n          ) : (\n            /* --- STANDARD HEADER (Manufacturing) --- */\n            <Card className=\"border-0 shadow-sm glass-panel overflow-hidden hover-lift transition-all\">\n              <div style={{ height: '4px', background: 'linear-gradient(90deg, #10b981, #3b82f6)' }}></div>\n              <Card.Body className=\"p-0\">\n                <div className=\"px-4 py-3 border-bottom d-flex align-items-center justify-content-between bg-white bg-opacity-50\">\n                  <h4 className=\"fw-bold m-0 text-gradient-indigo text-uppercase tracking-tight\">{auditData.audit.template_name} Verification</h4>\n                  <div className=\"d-flex gap-2\">\n                    <Badge bg=\"success\" pill className=\"px-3 border border-success border-opacity-25 shadow-xs\">ACTIVE SESSION</Badge>\n                  </div>\n                </div>\n                <div className=\"row g-0 bg-white border-bottom border-light overflow-hidden\">\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box primary\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Operational Unit</small>\n                      <div className=\"fw-bold text-dark\">{auditData.audit.machine_name}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box info\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Process Phase</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.operation || 'GENERAL'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-12 col-md-3 border-end border-light bg-light bg-opacity-10\">\n                    <div className=\"header-info-box danger\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Manufacturing Process</small>\n                      <div className=\"fw-bold text-danger text-truncate\">{auditData.audit.process || 'N/A'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box warning\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Component</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.part_name || 'N/A'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-3\">\n                    <div className=\"header-info-box success\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Lead Command</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.l1_auditor_name}</div>\n                    </div>\n                  </div>\n                </div>\n              </Card.Body>\n            </Card>\n          )}\n        </div>\n        <div className=\"d-flex flex-column gap-2 justify-content-center min-w-md-200\">\n          {/* L2 Action Buttons */}\n          {isScoringMode && (\n            <>\n              <Button variant=\"danger\" className=\"w-100 fw-bold py-2 shadow-sm\" onClick={() => setShowRejectModal(true)}>\n                <FaTimes /> Reject Audit\n              </Button>\n              <Button variant=\"success\" className=\"w-100 fw-bold py-2 shadow-sm\" onClick={() => setConfirmAction('approve')}>\n                <FaCheckDouble /> Approve\n              </Button>\n            </>\n          )}\n          <Button variant=\"white\" className=\"w-100 py-2 border shadow-sm\" onClick={() => navigate(-1)}>\n            <i className=\"bi bi-arrow-left me-2\"></i> Exit Workspace\n          </Button>\n        </div>\n      </div>\n\n      {auditData.audit.status === 'Rejected' && auditData.rejection_reason && (\n        <Alert variant=\"danger\" className=\"mb-4 border-0 shadow-sm rounded-4 d-flex align-items-center\">\n          <div className=\"me-3 fs-3\">‚ö†Ô∏è</div>\n          <div>\n            <h6 className=\"fw-bold mb-1\">Audit Rejected by L2</h6>\n            <p className=\"mb-0 opacity-75\">{auditData.rejection_reason}</p>\n          </div>\n        </Alert>\n      )}\n\n      <Card className=\"shadow-sm border-0\">\n        <Card.Header className=\"bg-white\">\n          <Nav variant=\"tabs\" activeKey={activeTab} onSelect={(k) => setActiveTab(k || 'checklist')}>\n            <Nav.Item><Nav.Link eventKey=\"checklist\" className=\"text-dark\">1. Checklist {isScoringMode && \"(Scoring)\"}</Nav.Link></Nav.Item>\n\n            {/* Dock Audit Specific Tabs */}\n            {auditData.audit.template_name === 'Dock Audit' && (\n              <Nav.Item><Nav.Link eventKey=\"product_audit\" className=\"text-dark\">2. Product Audit</Nav.Link></Nav.Item>\n            )}\n\n            {/* Only show additional tabs for Manufacturing audits, not Dock Audit */}\n            {auditData.audit.template_name !== 'Dock Audit' && (\n              <>\n                <Nav.Item><Nav.Link eventKey=\"objectives\" className=\"text-dark\">2. Objectives</Nav.Link></Nav.Item>\n                <Nav.Item><Nav.Link eventKey=\"calibration\" className=\"text-dark\">3. Calibration</Nav.Link></Nav.Item>\n                <Nav.Item><Nav.Link eventKey=\"parameters\" className=\"text-dark\">4. Parameters</Nav.Link></Nav.Item>\n              </>\n            )}\n          </Nav>\n        </Card.Header>\n        <Card.Body>\n          {activeTab === 'checklist' && (\n            <ChecklistTab\n              auditId={id!}\n              initialData={auditData.data.checklist}\n              ncs={auditData.data.ncs} // Pass NCs\n              onRefresh={fetchAudit}\n              readOnly={isReadOnly}\n              scoringMode={isScoringMode}\n              // For Dock Audit, exclude \"Product Audit\" section from this tab\n              sectionFilter={auditData.audit.template_name === 'Dock Audit' ? s => !s.includes(\"Product Audit\") : undefined}\n            />\n          )}\n\n          {activeTab === 'product_audit' && auditData.audit.template_name === 'Dock Audit' && (\n            <ChecklistTab\n              auditId={id!}\n              initialData={auditData.data.checklist}\n              ncs={auditData.data.ncs}\n              onRefresh={fetchAudit}\n              readOnly={isReadOnly}\n              scoringMode={isScoringMode}\n              // Only show \"Product Audit\" section\n              sectionFilter={s => s.includes(\"Product Audit\")}\n            />\n          )}\n\n          {/* Pass readOnly to other tabs to disable inputs for L2 */}\n          {activeTab === 'objectives' && auditData.audit.template_name !== 'Dock Audit' && (\n            <ObjectivesTab\n              auditId={id!}\n              initialData={auditData.data.objectives}\n              ncs={auditData.data.ncs}\n              readOnly={isReadOnly}\n              onRefresh={fetchAudit}\n            />\n          )}\n          {activeTab === 'calibration' && auditData.audit.template_name !== 'Dock Audit' && (\n            <CalibrationTab\n              auditId={id!}\n              initialData={auditData.data.calibrations}\n              ncs={auditData.data.ncs}\n              readOnly={isReadOnly}\n              onRefresh={fetchAudit}\n            />\n          )}\n          {activeTab === 'parameters' && auditData.audit.template_name !== 'Dock Audit' && (\n            <ParametersTab\n              auditId={id!}\n              initialData={auditData.data.parameters}\n              ncs={auditData.data.ncs}\n              readOnly={isReadOnly}\n              onRefresh={fetchAudit}\n            />\n          )}\n        </Card.Body>\n\n        {/* L1 Submit Button (Existing) */}\n        {isL1 && !isReadOnly && (\n          <Card.Footer className=\"bg-light d-flex justify-content-end\">\n            <Button\n              variant=\"primary\"\n              onClick={() => setConfirmAction('submit')}\n              disabled={auditData.audit.status === 'NC_Open' || auditData.audit.status === 'NC_Pending_Verify'}\n            >\n              Submit to L2 Auditor\n            </Button>\n          </Card.Footer>\n        )}\n      </Card>\n\n      {/* Reject Modal */}\n      <Modal show={showRejectModal} onHide={() => setShowRejectModal(false)}>\n        <Modal.Header closeButton><Modal.Title>Reject Audit</Modal.Title></Modal.Header>\n        <Modal.Body>\n          <Form.Group>\n            <Form.Label>Reason for Rejection</Form.Label>\n            <Form.Control as=\"textarea\" rows={3} value={rejectReason} onChange={e => setRejectReason(e.target.value)} />\n          </Form.Group>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"danger\" onClick={handleL2Reject}>Confirm Rejection</Button>\n        </Modal.Footer>\n      </Modal>\n\n      {/* Confirmation Modal */}\n      <ConfirmationModal\n        show={!!confirmAction}\n        onClose={() => setConfirmAction(null)}\n        onConfirm={() => {\n          if (confirmAction === 'submit') handleSubmitToL2();\n          if (confirmAction === 'approve') handleL2Approve();\n          setConfirmAction(null);\n        }}\n        title={confirmAction === 'submit' ? \"Submit Audit\" : \"Approve Audit\"}\n        message={\n          confirmAction === 'submit'\n            ? \"Submit to L2 for grading?\"\n            : \"Approve and Close this Audit? This is final.\"\n        }\n        confirmText={confirmAction === 'submit' ? \"Submit\" : \"Approve\"}\n        variant=\"primary\"\n      />\n    </Container>\n  );\n};\n\nexport default AuditWorkspace;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\l1\\MyTasks.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[488,491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[488,491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { Container, Table, Button, Badge, Form, Card } from 'react-bootstrap';\nimport { FaSearch, FaPaperclip } from 'react-icons/fa';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport api from '../../api/axios';\nimport Skeleton from '../../components/common/Skeleton';\nimport AuditEvidenceModal from '../../components/audit/AuditEvidenceModal';\n\nconst MyTasks = () => {\n  const [tasks, setTasks] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchParams] = useSearchParams();\n  const view = searchParams.get('view') || 'active';\n  const [searchTerm, setSearchTerm] = useState('');\n  const navigate = useNavigate();\n\n  const [showEvidenceModal, setShowEvidenceModal] = useState(false);\n  const [selectedAuditId, setSelectedAuditId] = useState<string | null>(null);\n\n  const fetchTasks = useCallback(async () => {\n    try {\n      // Use the unified endpoint with query param\n      const endpoint = `/audits/l1/my-tasks?view=${view}`;\n      const res = await api.get(endpoint);\n      setTasks(res.data);\n    } catch {\n      console.error(\"Failed to fetch tasks\");\n    } finally {\n      setLoading(false);\n    }\n  }, [view]);\n\n  useEffect(() => {\n    fetchTasks();\n  }, [fetchTasks]);\n\n  const filteredTasks = tasks.filter((t: { machine_name: string; template_name?: string }) =>\n    t.machine_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    t.template_name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const handleViewEvidence = (id: string) => {\n    setSelectedAuditId(id);\n    setShowEvidenceModal(true);\n  };\n\n  if (loading) {\n    return (\n      <Container className=\"py-4\">\n        {[1, 2, 3].map(i => (\n          <Skeleton key={i} height={100} className=\"mb-3\" borderRadius=\"8px\" />\n        ))}\n      </Container>\n    );\n  }\n\n  return (\n    <Container className=\"py-4\">\n      <div className=\"d-flex justify-content-between align-items-center mb-4\">\n        <div>\n          <h2 className=\"mb-0 fw-bold\">\n            {view === 'history' ? 'Audit History' : 'My Active Tasks'}\n          </h2>\n          <p className=\"text-muted\">\n            {view === 'history' ? 'View previously submitted audits.' : 'Tasks requiring your immediate attention.'}\n          </p>\n        </div>\n\n        <div style={{ width: '300px' }}>\n          <div className=\"position-relative\">\n            <FaSearch className=\"position-absolute text-muted\" style={{ top: '50%', left: '12px', transform: 'translateY(-50%)', zIndex: 5 }} />\n            <Form.Control\n              className=\"search-input-premium ps-5 border-0\"\n              placeholder=\"Search...\"\n              value={searchTerm}\n              onChange={e => setSearchTerm(e.target.value)}\n            />\n          </div>\n        </div>\n      </div>\n\n      <Card className=\"dashboard-card border-0 mb-4\">\n        <Card.Body className=\"p-0\">\n          <Table hover responsive className=\"mb-0 align-middle\">\n            <thead className=\"table-premium-header\">\n              <tr>\n                <th className=\"py-3 ps-4 border-0\">Date</th>\n                <th className=\"py-3 border-0\">Machine</th>\n                <th className=\"py-3 border-0\">Template</th>\n                <th className=\"py-3 border-0\">Status</th>\n                <th className=\"py-3 pe-4 text-center border-0\">Action</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredTasks.length > 0 ? (\n                filteredTasks.map((task: { audit_id: string; audit_date: string; machine_name: string; process?: string; template_name?: string; status: string }) => (\n                  <tr key={task.audit_id} className=\"hover-row transition-all\">\n                    <td className=\"ps-4 text-nowrap py-3\">\n                      <div className=\"fw-bold text-dark\">{new Date(task.audit_date).toLocaleDateString()}</div>\n                    </td>\n                    <td className=\"fw-bold text-dark py-3\">\n                      {task.machine_name}\n                      {task.process && (\n                        <div className=\"text-muted small fw-normal\" style={{ fontSize: '0.75rem' }}>\n                          Process: {task.process}\n                        </div>\n                      )}\n                    </td>\n                    <td className=\"text-muted small fw-medium py-3 text-uppercase\">{task.template_name?.replace(' Audit', '')}</td>\n                    <td className=\"py-3\">\n                      <Badge\n                        bg=\"light\" text=\"dark\"\n                        className={`badge-premium border-0 ${task.status === 'Completed' ? 'badge-success-subtle' :\n                          task.status === 'NC_Open' ? 'badge-danger-subtle' :\n                            task.status === 'Rejected' ? 'badge-danger-subtle' :\n                              task.status === 'Submitted_to_L2' ? 'badge-warning-subtle' : 'badge-primary-subtle'\n                          }`}\n                      >\n                        {task.status.replace(/_/g, ' ')}\n                      </Badge>\n                    </td>\n                    <td className=\"pe-4 py-3\">\n                      <div className=\"d-flex justify-content-center gap-2\">\n                        <Button\n                          variant={view === 'active' ? 'primary' : 'outline-primary'}\n                          size=\"sm\"\n                          className=\"px-3 fw-bold shadow-sm\"\n                          onClick={() => navigate(`/l1/audit/${task.audit_id}`)}\n                        >\n                          {view === 'active' ? 'Start Audit' : 'View'}\n                        </Button>\n\n                        <Button\n                          variant=\"outline-secondary\"\n                          size=\"sm\"\n                          className=\"border-0 bg-light text-muted\"\n                          title=\"View Evidence / Signatures\"\n                          onClick={() => handleViewEvidence(task.audit_id)}\n                        >\n                          <FaPaperclip />\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              ) : (\n                <tr>\n                  <td colSpan={5} className=\"text-center py-5 text-muted fw-medium\">\n                    <div className=\"d-flex flex-column align-items-center\">\n                      <div className=\"fs-1 mb-2\">üì≠</div>\n                      <div>No {view} tasks found.</div>\n                    </div>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </Table>\n        </Card.Body>\n      </Card>\n\n      <AuditEvidenceModal\n        show={showEvidenceModal}\n        onHide={() => setShowEvidenceModal(false)}\n        auditId={selectedAuditId}\n      />\n    </Container>\n  );\n};\n\nexport default MyTasks;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\l2\\Inbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[382,385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[382,385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { Container, Table, Button, Badge, Form, Card } from 'react-bootstrap';\nimport { FaSearch } from 'react-icons/fa';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport Skeleton from '../../components/common/Skeleton';\n\nconst Inbox = () => {\n  const [audits, setAudits] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [view, setView] = useState('active');\n  const navigate = useNavigate();\n\n  const fetchAudits = useCallback(async () => {\n    setLoading(true);\n    try {\n      const res = await api.get(`/audits/l2/inbox?view=${view}`);\n      setAudits(res.data);\n    } catch {\n      console.error(\"Failed to fetch inbox\");\n    } finally {\n      setLoading(false);\n    }\n  }, [view]);\n\n  useEffect(() => {\n    fetchAudits();\n  }, [fetchAudits]);\n\n  const filteredAudits = audits.filter((a: { machine_name: string; l1_auditor_name?: string }) =>\n    a.machine_name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    a.l1_auditor_name?.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  if (loading) {\n    return (\n      <Container className=\"py-4\">\n        <div className=\"mb-4\">\n          <Skeleton width={200} height={32} className=\"mb-2\" />\n          <Skeleton width={300} height={18} />\n        </div>\n        <Card className=\"border-0 shadow-sm\">\n          <Card.Body className=\"p-4\">\n            {[1, 2, 3, 4, 5].map(i => (\n              <Skeleton key={i} height={40} className=\"mb-2\" />\n            ))}\n          </Card.Body>\n        </Card>\n      </Container>\n    );\n  }\n\n  return (\n    <Container className=\"py-4\">\n      <div className=\"d-flex justify-content-between align-items-center mb-4\">\n        <div>\n          <h2 className=\"mb-0 fw-bold\">\n            {view === 'history' ? 'Audit History' : 'Review Inbox'}\n          </h2>\n          <p className=\"text-muted\">\n            {view === 'history' ? 'View previously approved/completed audits.' : 'Review and score audits submitted by the field teams.'}\n          </p>\n        </div>\n\n        <div className=\"d-flex align-items-center gap-3\">\n          <div className=\"btn-group shadow-sm bg-white p-1 rounded-3\">\n            <Button\n              variant={view === 'active' ? 'primary' : 'white'}\n              size=\"sm\"\n              className=\"rounded-2 px-3\"\n              onClick={() => setView('active')}\n            >\n              Active\n            </Button>\n            <Button\n              variant={view === 'history' ? 'primary' : 'white'}\n              size=\"sm\"\n              className=\"rounded-2 px-3\"\n              onClick={() => setView('history')}\n            >\n              History\n            </Button>\n          </div>\n\n          <div style={{ width: '300px' }}>\n            <div className=\"position-relative\">\n              <FaSearch className=\"position-absolute text-muted\" style={{ top: '50%', left: '12px', transform: 'translateY(-50%)', zIndex: 5 }} />\n              <Form.Control\n                className=\"search-input-premium ps-5 border-0\"\n                placeholder=\"Search...\"\n                value={searchTerm}\n                onChange={e => setSearchTerm(e.target.value)}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Card className=\"dashboard-card border-0 mb-4\">\n        <Card.Body className=\"p-0\">\n          <Table hover responsive className=\"mb-0 align-middle\">\n            <thead className=\"table-premium-header\">\n              <tr>\n                <th className=\"py-3 ps-4 border-0\">Date</th>\n                <th className=\"py-3 border-0\">Machine</th>\n                <th className=\"py-3 border-0\">L1 Auditor</th>\n                <th className=\"py-3 border-0\">Status</th>\n                <th className=\"py-3 pe-4 text-center border-0\">Action</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredAudits.length > 0 ? (\n                filteredAudits.map((audit: { audit_id: string; audit_date: string; machine_name: string; l1_auditor_name?: string; status: string }) => (\n                  <tr key={audit.audit_id} className=\"hover-row transition-all\">\n                    <td className=\"ps-4 text-nowrap py-3\">\n                      <div className=\"fw-bold text-dark\">{new Date(audit.audit_date).toLocaleDateString()}</div>\n                    </td>\n                    <td className=\"fw-bold text-primary py-3\">{audit.machine_name}</td>\n                    <td className=\"text-muted small fw-medium py-3\">{audit.l1_auditor_name || 'N/A'}</td>\n                    <td className=\"py-3\">\n                      <Badge\n                        bg=\"light\" text=\"dark\"\n                        className={`badge-premium border-0 ${audit.status === 'Completed' ? 'badge-success-subtle' :\n                          audit.status === 'Submitted_to_L2' ? 'badge-warning-subtle' :\n                            audit.status === 'Rejected' ? 'badge-danger-subtle' : 'badge-primary-subtle'\n                          }`}\n                      >\n                        {audit.status.replace(/_/g, ' ')}\n                      </Badge>\n                    </td>\n                    <td className=\"pe-4 text-center py-3\">\n                      <Button\n                        variant={view === 'active' ? 'primary' : 'outline-primary'}\n                        size=\"sm\"\n                        className=\"px-4 fw-bold shadow-sm\"\n                        onClick={() => navigate(`/l2/audit/${audit.audit_id}`)}\n                      >\n                        {view === 'active' ? 'Review' : 'View'}\n                      </Button>\n                    </td>\n                  </tr>\n                ))\n              ) : (\n                <tr>\n                  <td colSpan={5} className=\"text-center py-5 text-muted fw-medium\">\n                    <div className=\"d-flex flex-column align-items-center\">\n                      <div className=\"fs-1 mb-2\">üì•</div>\n                      <div>No {view} audits found.</div>\n                    </div>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </Table>\n        </Card.Body>\n      </Card>\n    </Container>\n  );\n};\n\nexport default Inbox;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\l2\\ScoringWorkspace.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1122,1125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1122,1125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1161,1164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1161,1164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1186,1189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1186,1189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2287,2290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2287,2290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2668,2671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2668,2671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport api from '../../api/axios';\nimport { Container, Card, Nav, Button, Modal, Form, Badge } from 'react-bootstrap';\nimport { FaCheckCircle, FaTimesCircle, FaArrowLeft } from 'react-icons/fa';\nimport { toast } from 'react-toastify';\nimport ChecklistTab from '../../components/audit/tabs/ChecklistTab';\nimport ObjectivesTab from '../../components/audit/tabs/ObjectivesTab';\nimport CalibrationTab from '../../components/audit/tabs/CalibrationTab';\nimport ParametersTab from '../../components/audit/tabs/ParametersTab';\nimport ConfirmationModal from '../../components/common/ConfirmationModal';\nimport Skeleton from '../../components/common/Skeleton';\n\n\n\ninterface AuditResponse {\n  audit: {\n    template_name: string;\n    audit_id: string;\n    audit_date: string;\n    part_name: string;\n    part_number: string;\n    series: string;\n    shift: string;\n    qty_audited: number;\n    l1_auditor_name: string;\n    machine_name: string;\n    operation: string;\n    process: string;\n  };\n  data: {\n    checklist: any[];\n    ncs: any[];\n    objectives: any[];\n    calibrations: any[];\n    parameters: any[];\n  };\n}\n\nconst ScoringWorkspace = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n\n  const [loading, setLoading] = useState(true);\n  const [activeTab, setActiveTab] = useState('checklist');\n  const [auditData, setAuditData] = useState<AuditResponse | null>(null);\n\n  // Rejection State\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [rejectReason, setRejectReason] = useState('');\n\n  // Confirmation State\n  const [showApproveConfirm, setShowApproveConfirm] = useState(false);\n\n  const fetchAudit = useCallback(async () => {\n    try {\n      const res = await api.get(`/audits/${id}/full`);\n      setAuditData(res.data);\n    } catch {\n      toast.error('Error loading audit');\n      navigate('/l2/inbox');\n    } finally {\n      setLoading(false);\n    }\n  }, [id, navigate]);\n\n  useEffect(() => { fetchAudit(); }, [fetchAudit]);\n\n  const handleApprove = async () => {\n    try {\n      await api.put(`/audits/${id}/approve`);\n      toast.success(\"Audit Approved Successfully!\");\n      navigate('/l2/inbox');\n    } catch (err: any) {\n      toast.error(err.response?.data?.error || \"Approval Failed\");\n    }\n  };\n\n  const handleReject = async () => {\n    if (!rejectReason) return toast.warning(\"Please provide a reason.\");\n    try {\n      await api.put(`/audits/${id}/reject`, { reason: rejectReason });\n      toast.info(\"Audit Rejected and sent back to L1.\");\n      navigate('/l2/inbox');\n    } catch (err: any) {\n      toast.error(err.response?.data?.error || \"Rejection Failed\");\n    }\n  };\n\n  if (loading) {\n    return (\n      <Container fluid className=\"py-4 fade-in\">\n        <Skeleton height={150} borderRadius=\"1rem\" className=\"mb-4\" />\n        <Card className=\"border-0 shadow-sm rounded-4\">\n          <Card.Header className=\"bg-white py-3 border-bottom d-flex gap-3\">\n            <Skeleton width={100} height={20} />\n            <Skeleton width={100} height={20} />\n          </Card.Header>\n          <Card.Body>\n            {[1, 2, 3, 4, 5].map(i => (\n              <div key={i} className=\"mb-3 d-flex gap-3 align-items-center\">\n                <Skeleton width={30} height={30} borderRadius=\"50%\" />\n                <Skeleton height={20} />\n              </div>\n            ))}\n          </Card.Body>\n        </Card>\n      </Container>\n    );\n  }\n\n  return (\n    <Container fluid className=\"py-4 fade-in\">\n      <Button variant=\"link\" className=\"text-decoration-none mb-3 ps-0\" onClick={() => navigate('/l2/inbox')}>\n        <FaArrowLeft /> Back to Inbox\n      </Button>\n\n      <div className=\"d-flex flex-column flex-lg-row justify-content-between align-items-stretch gap-3 mb-4\">\n        <div className=\"flex-grow-1\">\n          {auditData.audit.template_name === 'Dock Audit' ? (\n            /* --- DOCK AUDIT HEADER (Premium Format) --- */\n            <Card className=\"border-0 shadow-sm glass-panel overflow-hidden hover-lift transition-all\">\n              <div style={{ height: '4px', background: 'linear-gradient(90deg, #6366f1, #10b981)' }}></div>\n              <Card.Body className=\"p-0\">\n                <div className=\"px-4 py-3 border-bottom d-flex align-items-center justify-content-between bg-white bg-opacity-50\">\n                  <h4 className=\"fw-bold m-0 text-gradient-indigo text-uppercase tracking-wider\">Product Integrity Protocol</h4>\n                  <Badge pill bg=\"indigo-light\" className=\"px-3 py-2 text-indigo border border-indigo-subtle\" style={{ backgroundColor: 'rgba(99, 102, 241, 0.1)', color: '#6366f1' }}>\n                    PROTOCOL REF: {auditData.audit.audit_id}\n                  </Badge>\n                </div>\n                <div className=\"row g-0\">\n                  <div className=\"col-md-4 border-end border-light\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Product Nomenclature</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.part_name || '-'}</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Product Serial/Batch</small>\n                      <span className=\"fw-bold text-dark text-uppercase\">{auditData.audit.part_number || '-'}</span>\n                    </div>\n                  </div>\n                  <div className=\"col-md-4 border-end border-light\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Verification Timeline</small>\n                      <span className=\"fw-bold text-dark\">{new Date(auditData.audit.audit_date).toLocaleDateString(undefined, { dateStyle: 'long' })}</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Production Series</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.series || '-'} / Shift: {auditData.audit.shift}</span>\n                    </div>\n                  </div>\n                  <div className=\"col-md-4\">\n                    <div className=\"p-3 border-bottom border-light\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Inspection Vol.</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.qty_audited || '-'} Units Audited</span>\n                    </div>\n                    <div className=\"p-3\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest\" style={{ fontSize: '0.6rem' }}>Authorized Auditor</small>\n                      <span className=\"fw-bold text-dark\">{auditData.audit.l1_auditor_name}</span>\n                    </div>\n                  </div>\n                </div>\n              </Card.Body>\n            </Card>\n          ) : (\n            /* --- STANDARD HEADER (Manufacturing) --- */\n            <Card className=\"border-0 shadow-sm glass-panel overflow-hidden hover-lift transition-all\">\n              <div style={{ height: '4px', background: 'linear-gradient(90deg, #10b981, #3b82f6)' }}></div>\n              <Card.Body className=\"p-0\">\n                <div className=\"px-4 py-3 border-bottom d-flex align-items-center justify-content-between bg-white bg-opacity-50\">\n                  <h4 className=\"fw-bold m-0 text-gradient-indigo text-uppercase tracking-tight\">{auditData.audit.template_name} Verification</h4>\n                  <div className=\"d-flex gap-2\">\n                    <Badge bg=\"success\" pill className=\"px-3 border border-success border-opacity-25 shadow-xs\">ACTIVE SESSION</Badge>\n                  </div>\n                </div>\n                <div className=\"row g-0 bg-white border-bottom border-light overflow-hidden\">\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box primary\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Operational Unit</small>\n                      <div className=\"fw-bold text-dark\">{auditData.audit.machine_name}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box info\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Process Phase</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.operation || 'GENERAL'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-12 col-md-3 border-end border-light bg-light bg-opacity-10\">\n                    <div className=\"header-info-box danger\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Manufacturing Process</small>\n                      <div className=\"fw-bold text-danger text-truncate\">{auditData.audit.process || 'N/A'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-2 border-end border-light\">\n                    <div className=\"header-info-box warning\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Component</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.part_name || 'N/A'}</div>\n                    </div>\n                  </div>\n                  <div className=\"col-6 col-md-3\">\n                    <div className=\"header-info-box success\">\n                      <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Lead Command</small>\n                      <div className=\"fw-bold text-dark text-truncate\">{auditData.audit.l1_auditor_name}</div>\n                    </div>\n                  </div>\n                </div>\n              </Card.Body>\n            </Card>\n          )}\n        </div>\n        <div className=\"d-flex flex-column gap-2 justify-content-center min-w-md-200\">\n          <Button variant=\"danger\" className=\"w-100 fw-bold py-2 shadow-sm\" onClick={() => setShowRejectModal(true)}>\n            <FaTimesCircle className=\"me-2\" /> Reject Audit\n          </Button>\n          <Button variant=\"success\" className=\"w-100 fw-bold py-2 shadow-sm\" onClick={() => setShowApproveConfirm(true)}>\n            <FaCheckCircle className=\"me-2\" /> Approve & Close\n          </Button>\n          <Button variant=\"white\" className=\"w-100 py-2 border shadow-sm\" onClick={() => navigate('/l2/inbox')}>\n            <FaArrowLeft className=\"me-2\" /> Exit Workspace\n          </Button>\n        </div>\n      </div>\n\n      <Card className=\"shadow-sm border-0\">\n        <Card.Header className=\"bg-white\">\n          <Nav variant=\"tabs\" activeKey={activeTab} onSelect={(k) => setActiveTab(k || 'checklist')}>\n            <Nav.Item><Nav.Link eventKey=\"checklist\" className=\"text-dark\">1. Checklist (Grading)</Nav.Link></Nav.Item>\n\n            {/* Dock Audit Specific Tabs */}\n            {auditData.audit.template_name === 'Dock Audit' && (\n              <Nav.Item><Nav.Link eventKey=\"product_audit\" className=\"text-dark\">2. Product Audit</Nav.Link></Nav.Item>\n            )}\n\n            {/* Only show additional tabs for Manufacturing audits, not Dock Audit */}\n            {auditData.audit.template_name !== 'Dock Audit' && (\n              <>\n                <Nav.Item><Nav.Link eventKey=\"objectives\" className=\"text-dark\">2. Objectives</Nav.Link></Nav.Item>\n                <Nav.Item><Nav.Link eventKey=\"calibration\" className=\"text-dark\">3. Calibration</Nav.Link></Nav.Item>\n                <Nav.Item><Nav.Link eventKey=\"parameters\" className=\"text-dark\">4. Parameters</Nav.Link></Nav.Item>\n              </>\n            )}\n          </Nav>\n        </Card.Header>\n        <Card.Body>\n          {activeTab === 'checklist' && (\n            <ChecklistTab\n              auditId={id!}\n              initialData={auditData.data.checklist}\n              ncs={auditData.data.ncs}\n              onRefresh={fetchAudit}\n              readOnly={true}      // L2 cannot edit observations\n              scoringMode={true}   // L2 CAN see Score Buttons\n              // For Dock Audit, exclude \"Product Audit\" section from this tab\n              sectionFilter={auditData.audit.template_name === 'Dock Audit' ? s => !s.includes(\"Product Audit\") : undefined}\n            />\n          )}\n\n          {activeTab === 'product_audit' && auditData.audit.template_name === 'Dock Audit' && (\n            <ChecklistTab\n              auditId={id!}\n              initialData={auditData.data.checklist}\n              ncs={auditData.data.ncs}\n              onRefresh={fetchAudit}\n              readOnly={true}\n              scoringMode={true}\n              // Only show \"Product Audit\" section\n              sectionFilter={s => s.includes(\"Product Audit\")}\n            />\n          )}\n\n          {/* Other tabs are purely Read-Only for L2 */}\n          {activeTab === 'objectives' && auditData.audit.template_name !== 'Dock Audit' && <ObjectivesTab auditId={id!} initialData={auditData.data.objectives} readOnly={true} onRefresh={() => { }} />}\n          {activeTab === 'calibration' && auditData.audit.template_name !== 'Dock Audit' && <CalibrationTab auditId={id!} initialData={auditData.data.calibrations} readOnly={true} onRefresh={() => { }} />}\n          {activeTab === 'parameters' && auditData.audit.template_name !== 'Dock Audit' && <ParametersTab auditId={id!} initialData={auditData.data.parameters} readOnly={true} onRefresh={() => { }} />}\n        </Card.Body>\n      </Card>\n\n      {/* Reject Modal */}\n      <Modal show={showRejectModal} onHide={() => setShowRejectModal(false)}>\n        <Modal.Header closeButton className=\"bg-danger text-white\">\n          <Modal.Title>Reject Audit</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <p>This will send the audit back to the L1 Auditor for corrections.</p>\n          <Form.Group>\n            <Form.Label className=\"fw-bold\">Reason for Rejection</Form.Label>\n            <Form.Control\n              as=\"textarea\"\n              rows={3}\n              value={rejectReason}\n              onChange={e => setRejectReason(e.target.value)}\n              placeholder=\"Missing calibration data...\"\n            />\n          </Form.Group>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={() => setShowRejectModal(false)}>Cancel</Button>\n          <Button variant=\"danger\" onClick={handleReject}>Confirm Rejection</Button>\n        </Modal.Footer>\n      </Modal>\n\n      {/* Approve Confirmation Modal */}\n      <ConfirmationModal\n        show={showApproveConfirm}\n        onClose={() => setShowApproveConfirm(false)}\n        onConfirm={() => {\n          handleApprove();\n          setShowApproveConfirm(false);\n        }}\n        title=\"Approve Audit\"\n        message=\"Are you sure you want to Approve this audit? This will lock the scores permanently.\"\n        confirmText=\"Approve\"\n        variant=\"success\"\n      />\n    </Container>\n  );\n};\n\nexport default ScoringWorkspace;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\owner\\MyNCs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\src\\pages\\owner\\NCResolution.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[528,531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[528,531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2341,2344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2341,2344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Container, Card, Form, Button, Row, Col, Alert, Spinner, Badge } from 'react-bootstrap';\nimport { FaArrowLeft, FaCheck } from 'react-icons/fa';\nimport api from '../../api/axios';\nimport FilePreview from '../../components/common/FilePreview';\nimport { toast } from 'react-toastify';\n\nconst NCResolution = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [ncData, setNcData] = useState<any | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  // Form State\n  const [rootCause, setRootCause] = useState('');\n  const [correctiveAction, setCorrectiveAction] = useState('');\n  const [file, setFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [submitting, setSubmitting] = useState(false);\n\n  useEffect(() => {\n    const fetchDetails = async () => {\n      try {\n        const res = await api.get(`/nc/${id}`);\n        setNcData(res.data);\n      } catch {\n        toast.error(\"Error fetching NC details\");\n        navigate('/owner/tasks');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchDetails();\n  }, [id, navigate]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!rootCause || !correctiveAction)\n      return toast.warning(\"Please fill all fields\");\n\n    setSubmitting(true);\n    try {\n      let evidenceUrl = null;\n\n      // -----------------------------\n      // 1. UPLOAD FILE + SHOW PREVIEW\n      // -----------------------------\n      if (file) {\n        const formData = new FormData();\n        formData.append('file', file);\n\n        const uploadRes = await api.post('/upload', formData, {\n          headers: { 'Content-Type': 'multipart/form-data' }\n        });\n\n        evidenceUrl = uploadRes.data.url;\n        setPreviewUrl(evidenceUrl);\n      }\n\n      // -----------------------------\n      // 2. SUBMIT NC RESOLUTION\n      // -----------------------------\n      await api.post(`/nc/${id}/resolve`, {\n        root_cause: rootCause,\n        corrective_action: correctiveAction,\n        evidence_url: evidenceUrl\n      });\n\n      toast.success(\"Resolution Submitted! Sent to L1 for verification.\");\n      navigate('/owner/tasks');\n\n    } catch (err: any) {\n      toast.error(err.response?.data?.error || \"Failed to submit\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (loading)\n    return <div className=\"text-center mt-5\"><Spinner animation=\"border\" /></div>;\n\n  return (\n    <Container className=\"py-4\" style={{ maxWidth: '800px' }}>\n      <Button variant=\"link\" className=\"text-decoration-none mb-3 ps-0\"\n        onClick={() => navigate('/owner/tasks')}>\n        <FaArrowLeft /> Back to List\n      </Button>\n\n      {/* NC DETAILS */}\n      <Card className=\"border-0 shadow-sm glass-panel overflow-hidden hover-lift transition-all mb-4\">\n        <div style={{ height: '4px', background: 'linear-gradient(90deg, #ef4444, #f59e0b)' }}></div>\n        <Card.Body className=\"p-0\">\n          <div className=\"px-4 py-3 border-bottom d-flex align-items-center justify-content-between bg-white bg-opacity-50\">\n            <h5 className=\"fw-bold m-0 text-danger text-uppercase tracking-tight\">Non-Conformance Details</h5>\n            <Badge bg=\"danger\" pill className=\"px-3 border border-danger border-opacity-25 shadow-xs\">URGENT ACTION</Badge>\n          </div>\n          <div className=\"p-4 bg-white\">\n            <Row className=\"g-4\">\n              <Col md={6}>\n                <div className=\"header-info-box primary\">\n                  <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Machine / Area</small>\n                  <div className=\"fw-bold text-dark\">{ncData.machine_name}</div>\n                </div>\n              </Col>\n              <Col md={6}>\n                <div className=\"header-info-box info\">\n                  <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Date Raised</small>\n                  <div className=\"fw-bold text-dark\">{new Date(ncData.created_at).toLocaleDateString()}</div>\n                </div>\n              </Col>\n              <Col md={12}>\n                <div className=\"header-info-box danger bg-danger bg-opacity-10\">\n                  <small className=\"text-muted text-uppercase fw-bold d-block mb-1 tracking-widest x-small\">Issue Description</small>\n                  <div className=\"fw-bold text-danger\">\"{ncData.issue_description}\"</div>\n                </div>\n              </Col>\n\n              {ncData.issue_image_url && (\n                <Col md={12}>\n                  <div className=\"border rounded p-3 bg-light\">\n                    <small className=\"text-muted text-uppercase fw-bold d-block mb-2 tracking-widest x-small\">Issue Evidence (Auditor Attached)</small>\n                    <div style={{ maxWidth: '400px' }}>\n                      <FilePreview fileUrl={ncData.issue_image_url} />\n                    </div>\n                  </div>\n                </Col>\n              )}\n            </Row>\n          </div>\n        </Card.Body>\n      </Card>\n\n      {/* RESOLUTION FORM */}\n      <Card className=\"shadow-sm border-0 rounded-4 overflow-hidden\">\n        <Card.Body className=\"p-4\">\n          <h5 className=\"mb-4 text-primary fw-bold d-flex align-items-center\">\n            <span className=\"bg-primary text-white rounded-circle me-2 d-inline-flex justify-content-center align-items-center\" style={{ width: '24px', height: '24px', fontSize: '14px' }}>R</span>\n            Corrective Action Plan\n          </h5>\n\n          <Form onSubmit={handleSubmit}>\n\n            {/* ROOT CAUSE */}\n            <Form.Group className=\"mb-3\">\n              <Form.Label className=\"fw-bold small\">1. Root Cause Analysis</Form.Label>\n              <Form.Control\n                as=\"textarea\"\n                rows={3}\n                className=\"border-light shadow-xs\"\n                placeholder=\"Why did this happen?\"\n                value={ncData.root_cause || rootCause}\n                onChange={e => setRootCause(e.target.value)}\n                required\n                disabled={ncData.status !== 'Open'}\n              />\n            </Form.Group>\n\n            {/* CORRECTIVE ACTION */}\n            <Form.Group className=\"mb-3\">\n              <Form.Label className=\"fw-bold small\">2. Corrective Action Taken</Form.Label>\n              <Form.Control\n                as=\"textarea\"\n                rows={3}\n                className=\"border-light shadow-xs\"\n                placeholder=\"What did you do to fix it?\"\n                value={ncData.corrective_action || correctiveAction}\n                onChange={e => setCorrectiveAction(e.target.value)}\n                required\n                disabled={ncData.status !== 'Open'}\n              />\n            </Form.Group>\n\n            {/* EVIDENCE UPLOAD + PREVIEW */}\n            <Form.Group className=\"mb-4\">\n              <Form.Label className=\"fw-bold small\">3. Evidence (Photo/Document)</Form.Label>\n              <div className=\"border border-dashed rounded p-4 bg-light bg-opacity-50 text-center\">\n\n                {ncData.status === 'Open' && (\n                  <Form.Control\n                    type=\"file\"\n                    className=\"mb-2\"\n                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => setFile(e.target.files ? e.target.files[0] : null)}\n                  />\n                )}\n\n                {(previewUrl || ncData.evidence_url) && (\n                  <div className=\"mt-3\">\n                    <FilePreview fileUrl={ncData.evidence_url || previewUrl} />\n                  </div>\n                )}\n\n                {ncData.status === 'Open' && (\n                  <Form.Text className=\"text-muted small d-block mt-2\">\n                    Optional but recommended. Upload proof of the fix.\n                  </Form.Text>\n                )}\n              </div>\n            </Form.Group>\n\n            {/* SUBMIT BUTTON */}\n            {ncData.status === 'Open' && (\n              <div className=\"d-grid pt-3\">\n                <Button variant=\"success\" size=\"lg\" type=\"submit\" className=\"fw-bold shadow-sm py-3\" disabled={submitting}>\n                  {submitting\n                    ? <Spinner size=\"sm\" animation=\"border\" />\n                    : <><FaCheck className=\"me-2\" /> Submit for Verification</>}\n                </Button>\n              </div>\n            )}\n            {ncData.status !== 'Open' && (\n              <Alert variant=\"info\">\n                This NC has been resolved and is currently <strong>{ncData.status}</strong>.\n              </Alert>\n            )}\n\n          </Form>\n        </Card.Body>\n      </Card>\n    </Container>\n  );\n};\n\nexport default NCResolution;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Asus\\OneDrive\\Desktop\\auditchecksheet - Copy\\Digitization-of-Audit-Checksheets-Veeresh-veeresh_n-main\\frontend\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]